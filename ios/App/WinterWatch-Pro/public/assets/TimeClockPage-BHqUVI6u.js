import{d as R,r as c,j as e,C as x,m as h,n as f,b as p,U as z,o as U,I as V,L as H,B as J,s as I,f as y}from"./index-BTTndiCa.js";import{A as K}from"./AppLayout-CdmLHGoC.js";import{B as k,S as Q,a as W,b as X,c as Y,d as D}from"./select-CkuTWz4P.js";import{T as Z,a as ee,b as A,c as d,d as se,e as m}from"./table-ByQioMfz.js";import{C as te}from"./clock-91DdfKYf.js";import{S as ae}from"./search-CUdo4Vh7.js";import{C as re,s as le,e as oe}from"./subDays-BQ2HQSuo.js";import{P as ce}from"./pencil-VyY2SQ7L.js";import{P as ie,T as ne}from"./timer-9Sr9DBrb.js";import{M as de}from"./map-pin-Dw0f1SUM.js";import{L as me}from"./log-out-D3n32clD.js";import{d as ue,g as xe}from"./differenceInMilliseconds-CqskIra_.js";import{m as he,f as M,s as fe}from"./format-D46ChU1D.js";import{d as $}from"./differenceInMinutes-CDNvr38S.js";import"./index-C_FqIwIg.js";import"./Combination-BI3QGdrN.js";import"./truck-GV-QDD0s.js";import"./shovel-CsAXD17G.js";import"./user-MPZ2r4HK.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=R("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);function ge(o,g,i){const n=ue(o,g)/he;return xe(i==null?void 0:i.roundingMethod)(n)}function je({clockInTime:o}){const[g,i]=c.useState("");return c.useEffect(()=>{const n=()=>{const S=new Date(o).getTime(),b=Date.now()-S,_=Math.floor(b/(1e3*60*60)),v=Math.floor(b%(1e3*60*60)/(1e3*60)),w=Math.floor(b%(1e3*60)/1e3);i(`${_.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`)};n();const j=setInterval(n,1e3);return()=>clearInterval(j)},[o]),e.jsx("span",{className:"font-mono tabular-nums",children:g})}function Pe(){const[o,g]=c.useState([]),[i,n]=c.useState(!0),[j,S]=c.useState(""),[N,b]=c.useState("7"),[_,v]=c.useState(null),w=async()=>{n(!0);try{const s=parseInt(N),t=fe(le(new Date,s-1)).toISOString(),a=oe(new Date).toISOString(),{data:r,error:l}=await I.from("time_clock").select("*, employee:employees(first_name, last_name), created_at, updated_at").gte("clock_in_time",t).lte("clock_in_time",a).order("clock_in_time",{ascending:!1});if(l)throw l;g(r||[])}catch(s){console.error("Error fetching time entries:",s),y.error("Failed to load time entries")}finally{n(!1)}};c.useEffect(()=>{w()},[N]);const O=async s=>{v(s);try{let t=null;if(navigator.geolocation)try{const l=await new Promise((u,G)=>{navigator.geolocation.getCurrentPosition(u,G,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})});t={latitude:l.coords.latitude,longitude:l.coords.longitude}}catch(l){console.warn("Could not get GPS location:",l)}const a={clock_out_time:new Date().toISOString()};t&&(a.clock_out_latitude=t.latitude,a.clock_out_longitude=t.longitude);const{error:r}=await I.from("time_clock").update(a).eq("id",s);if(r)throw r;y.success("Employee clocked out successfully"+(t?" with GPS":"")),w()}catch(t){console.error("Error clocking out:",t),y.error("Failed to clock out employee")}finally{v(null)}},T=o.filter(s=>{if(!j)return!0;const t=j.toLowerCase();return(s.employee?`${s.employee.first_name} ${s.employee.last_name}`.toLowerCase():"").includes(t)}),C=(()=>{const s=new Map;return o.forEach(t=>{if(!t.employee)return;const a=`${t.employee.first_name} ${t.employee.last_name}`,r=s.get(a)||{name:a,totalHours:0,shifts:0,isActive:!1};if(t.clock_in_time){const l=t.clock_out_time?new Date(t.clock_out_time):new Date,u=$(l,new Date(t.clock_in_time))/60;r.totalHours+=u,r.shifts+=1,t.clock_out_time||(r.isActive=!0)}s.set(a,r)}),Array.from(s.values()).sort((t,a)=>a.totalHours-t.totalHours)})(),P=C.reduce((s,t)=>s+t.totalHours,0),F=o.filter(s=>!s.clock_out_time).length,B=new Set(o.map(s=>s.employee_id)).size,q=(s,t)=>{const a=new Date(s),r=t?new Date(t):new Date,l=ge(r,a),u=$(r,a)%60;return l>0?`${l}h ${u}m`:`${u}m`},E=s=>{if(!s.updated_at)return!1;const t=new Date(s.updated_at).getTime(),a=s.clock_out_time?new Date(s.clock_out_time).getTime():new Date(s.clock_in_time).getTime();return t-a>5e3},L=s=>s?M(new Date(s),"h:mm a"):"-";return e.jsx(K,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(te,{className:"h-6 w-6 text-primary"}),"Time Clock"]}),e.jsx("p",{className:"text-muted-foreground",children:"Track employee work hours and shifts"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(x,{className:"bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20",children:[e.jsx(h,{className:"pb-2",children:e.jsx(f,{className:"text-sm font-medium text-muted-foreground",children:"Total Hours"})}),e.jsxs(p,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[P.toFixed(1),"h"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last ",N," days"]})]})]}),e.jsxs(x,{className:"bg-gradient-to-br from-green-500/10 to-green-500/5 border-green-500/20",children:[e.jsx(h,{className:"pb-2",children:e.jsx(f,{className:"text-sm font-medium text-muted-foreground",children:"Active Shifts"})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:F}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently clocked in"})]})]}),e.jsxs(x,{className:"bg-gradient-to-br from-blue-500/10 to-blue-500/5 border-blue-500/20",children:[e.jsx(h,{className:"pb-2",children:e.jsx(f,{className:"text-sm font-medium text-muted-foreground",children:"Employees"})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-500",children:B}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active this period"})]})]}),e.jsxs(x,{className:"bg-gradient-to-br from-purple-500/10 to-purple-500/5 border-purple-500/20",children:[e.jsx(h,{className:"pb-2",children:e.jsx(f,{className:"text-sm font-medium text-muted-foreground",children:"Shifts Logged"})}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-500",children:o.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total entries"})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(x,{className:"bg-card/50 border-border/50",children:[e.jsxs(h,{children:[e.jsxs(f,{className:"text-base flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Employee Hours"]}),e.jsx(U,{children:"Total hours per employee"})]}),e.jsx(p,{children:C.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-6",children:"No data available"}):e.jsx("div",{className:"space-y-3",children:C.slice(0,8).map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.isActive&&e.jsx("span",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.shifts," shifts"]}),e.jsxs(k,{variant:"outline",children:[s.totalHours.toFixed(1),"h"]})]})]},s.name))})})]}),e.jsxs(x,{className:"lg:col-span-2 bg-card/50 border-border/50",children:[e.jsx(h,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx(f,{className:"text-base",children:"Time Entries"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 sm:w-[200px]",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Search employee...",value:j,onChange:s=>S(s.target.value),className:"pl-9 bg-background/50"})]}),e.jsxs(Q,{value:N,onValueChange:b,children:[e.jsxs(W,{className:"w-[130px] bg-background/50",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),e.jsx(X,{})]}),e.jsxs(Y,{children:[e.jsx(D,{value:"7",children:"Last 7 days"}),e.jsx(D,{value:"14",children:"Last 14 days"}),e.jsx(D,{value:"30",children:"Last 30 days"})]})]})]})]})}),e.jsx(p,{children:i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(H,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):T.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No time entries found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(A,{className:"border-border/50 hover:bg-transparent",children:[e.jsx(d,{children:"Employee"}),e.jsx(d,{children:"Date"}),e.jsx(d,{children:"Clock In"}),e.jsx(d,{children:"Clock Out"}),e.jsx(d,{children:"Duration"}),e.jsx(d,{children:"Status"}),e.jsx(d,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(se,{children:T.slice(0,15).map(s=>e.jsxs(A,{className:`border-border/50 ${E(s)?"bg-destructive/10":""}`,children:[e.jsx(m,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.employee?`${s.employee.first_name} ${s.employee.last_name}`:"-",E(s)&&e.jsxs(k,{variant:"outline",className:"text-destructive border-destructive/50 gap-1 text-xs",children:[e.jsx(ce,{className:"h-3 w-3"}),"Edited"]})]})}),e.jsx(m,{children:M(new Date(s.clock_in_time),"MM/dd/yy")}),e.jsxs(m,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-3 w-3 text-green-500"}),L(s.clock_in_time)]}),s.clock_in_latitude&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),"GPS recorded"]})]}),e.jsx(m,{children:s.clock_out_time?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3 text-red-500"}),L(s.clock_out_time)]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ne,{className:"h-3 w-3 text-muted-foreground"}),s.clock_out_time?q(s.clock_in_time,s.clock_out_time):e.jsx(je,{clockInTime:s.clock_in_time})]})}),e.jsx(m,{children:s.clock_out_time?e.jsx(k,{variant:"outline",children:"Completed"}):e.jsxs(k,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-green-400 mr-1.5 animate-pulse"}),"Active"]})}),e.jsx(m,{children:!s.clock_out_time&&e.jsx(J,{size:"sm",variant:"destructive",onClick:()=>O(s.id),disabled:_===s.id,className:"h-7 px-2",children:_===s.id?e.jsx(H,{className:"h-3 w-3 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"Clock Out"]})})})]},s.id))})]})})})]})]})]})})}export{Pe as default};
