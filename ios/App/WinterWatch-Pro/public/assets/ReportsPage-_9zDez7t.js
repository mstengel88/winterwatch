import{d as Ee,r as a,j as e,c as w,I as O,B as g,L as De,w as bs,g as At,y as Tt,Y as Mt,h as oe,Z as ks,s as k,C as ie,b as ce,e as Se,$ as Et,T as Lt,i as $t,k as ps,l as xs,f as D}from"./index-BTTndiCa.js";import{S as z,a as W,b as H,c as F,d as b,B as qe}from"./select-CkuTWz4P.js";import{T as Be,a as Ye,b as Q,c as x,d as Ge,e as u}from"./table-ByQioMfz.js";import{j as Ss,R as It,P as Pt,W as Ot,a as qt,c as Rt,D as zt,b as Ns,O as Wt,T as Ht,d as Ft,e as Ut,f as Vt,i as Je,k as Bt}from"./index-C_FqIwIg.js";import{D as Ze,a as Qe,b as Xe,c as es,e as Ds}from"./dialog-DzHIB3n4.js";import{F as _s,a as Yt,g as Gt}from"./pdfExport-BOAci1lN.js";import{T as Jt}from"./textarea-hKNpP3I7.js";import{t as Cs,f as v}from"./format-D46ChU1D.js";import{C as Kt}from"./Combination-BI3QGdrN.js";import{C as js}from"./clock-91DdfKYf.js";import{R as Zt}from"./refresh-cw-EZf9VRza.js";import{T as Te}from"./trash-2-RpLMvkye.js";import{P as fs}from"./plus-DnkJBOXp.js";import{P as Ke}from"./pencil-VyY2SQ7L.js";import{d as Me}from"./differenceInMinutes-CDNvr38S.js";import"./differenceInMilliseconds-CqskIra_.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=Ee("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=Ee("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=Ee("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=Ee("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=Ee("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);function el(r){const i=Cs(r),d=i.getMonth();return i.setFullYear(i.getFullYear(),d+1,0),i.setHours(23,59,59,999),i}function sl(r){const i=Cs(r);return i.setDate(1),i.setHours(0,0,0,0),i}function tl({open:r,onOpenChange:i,employees:d,initialData:h,onSave:_,isLoading:p=!1}){const[S,M]=a.useState(""),[N,A]=a.useState(""),[C,U]=a.useState(""),[$,G]=a.useState("");a.useEffect(()=>{if(h){M(h.employee_id);const y=new Date(h.clock_in_time);if(A(y.toISOString().split("T")[0]),U(y.toTimeString().slice(0,5)),h.clock_out_time){const K=new Date(h.clock_out_time);G(K.toTimeString().slice(0,5))}else G("")}else M(""),A(new Date().toISOString().split("T")[0]),U(""),G("")},[h,r]);const q=async y=>{y.preventDefault(),await _({id:h==null?void 0:h.id,employee_id:S,clock_in_date:N,clock_in_time:C,clock_out_time:$})},ee=!!h;return e.jsx(Ze,{open:r,onOpenChange:i,children:e.jsxs(Qe,{className:"sm:max-w-[425px]",children:[e.jsx(Xe,{children:e.jsx(es,{children:ee?"Edit Shift":"Add New Shift"})}),e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Employee"}),e.jsxs(z,{value:S,onValueChange:M,required:!0,children:[e.jsx(W,{children:e.jsx(H,{placeholder:"Select employee"})}),e.jsx(F,{children:d.filter(y=>y.id&&y.id.trim()!=="").map(y=>e.jsxs(b,{value:y.id,children:[y.first_name," ",y.last_name]},y.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Date"}),e.jsx(O,{type:"date",value:N,onChange:y=>A(y.target.value),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Clock In Time"}),e.jsx(O,{type:"time",value:C,onChange:y=>U(y.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Clock Out Time"}),e.jsx(O,{type:"time",value:$,onChange:y=>G(y.target.value)})]})]})]}),e.jsxs(Ds,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(g,{type:"submit",disabled:p||!S||!N||!C,children:[p&&e.jsx(De,{className:"h-4 w-4 mr-2 animate-spin"}),ee?"Update":"Create"]})]})]})]})})}function ll({open:r,onOpenChange:i,accounts:d,employees:h,equipment:_,initialData:p,onSave:S,isLoading:M=!1}){const[N,A]=a.useState("plow"),[C,U]=a.useState(""),[$,G]=a.useState(""),[q,ee]=a.useState(""),[y,K]=a.useState("plow"),[de,je]=a.useState(""),[me,fe]=a.useState(""),[J,ye]=a.useState(""),[se,ve]=a.useState(""),[te,we]=a.useState(""),[le,ge]=a.useState(""),[he,be]=a.useState(""),[ae,Ce]=a.useState("");a.useEffect(()=>{var c,Le,ue;if(p){if(A(p.type),U(p.account_id),G(p.employee_id||""),ee(p.equipment_id||""),K(p.service_type),p.check_in_time){const ke=new Date(p.check_in_time);je(ke.toISOString().split("T")[0]),fe(ke.toTimeString().slice(0,5))}if(p.check_out_time){const ke=new Date(p.check_out_time);ye(ke.toTimeString().slice(0,5))}ve(((c=p.snow_depth_inches)==null?void 0:c.toString())||""),we(((Le=p.salt_used_lbs)==null?void 0:Le.toString())||""),ge(((ue=p.ice_melt_used_lbs)==null?void 0:ue.toString())||""),be(p.weather_conditions||""),Ce(p.notes||"")}else A("plow"),U(""),G(""),ee(""),K("plow"),je(new Date().toISOString().split("T")[0]),fe(""),ye(""),ve(""),we(""),ge(""),be(""),Ce("")},[p,r]);const V=async c=>{c.preventDefault(),await S({id:p==null?void 0:p.id,type:N,account_id:C,employee_id:$,equipment_id:q||void 0,service_type:y,date:de,check_in_time:me,check_out_time:J,snow_depth_inches:se?parseFloat(se):void 0,salt_used_lbs:te?parseFloat(te):void 0,ice_melt_used_lbs:le?parseFloat(le):void 0,weather_conditions:he||void 0,notes:ae||void 0})},ne=!!p,E=N==="plow"?[{value:"plow",label:"Plow"},{value:"salt",label:"Salt"},{value:"both",label:"Plow/Salt"}]:[{value:"shovel",label:"Shovel Walks"},{value:"ice_melt",label:"Salt Walks"},{value:"both",label:"Shovel/Salt Walks"}];return e.jsx(Ze,{open:r,onOpenChange:i,children:e.jsxs(Qe,{className:"sm:max-w-[550px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Xe,{children:e.jsx(es,{children:ne?"Edit Work Log":"Add New Work Log"})}),e.jsxs("form",{onSubmit:V,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Log Type"}),e.jsxs(z,{value:N,onValueChange:c=>{A(c),K(c==="plow"?"plow":"shovel")},disabled:ne,children:[e.jsx(W,{children:e.jsx(H,{})}),e.jsxs(F,{children:[e.jsx(b,{value:"plow",children:"Plow (Driver)"}),e.jsx(b,{value:"shovel",children:"Shovel (Crew)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Account/Location"}),e.jsxs(z,{value:C,onValueChange:U,required:!0,children:[e.jsx(W,{children:e.jsx(H,{placeholder:"Select account"})}),e.jsx(F,{children:d.filter(c=>c.id&&c.id.trim()!=="").map(c=>e.jsx(b,{value:c.id,children:c.name},c.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Employee"}),e.jsxs(z,{value:$,onValueChange:G,required:!0,children:[e.jsx(W,{children:e.jsx(H,{placeholder:"Select employee"})}),e.jsx(F,{children:h.filter(c=>c.id&&c.id.trim()!=="").map(c=>e.jsxs(b,{value:c.id,children:[c.first_name," ",c.last_name]},c.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Service Type"}),e.jsxs(z,{value:y,onValueChange:K,children:[e.jsx(W,{children:e.jsx(H,{})}),e.jsx(F,{children:E.map(c=>e.jsx(b,{value:c.value,children:c.label},c.value))})]})]}),N==="plow"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Equipment"}),e.jsxs(z,{value:q,onValueChange:c=>ee(c==="none"?"":c),children:[e.jsx(W,{children:e.jsx(H,{placeholder:"Select equipment"})}),e.jsxs(F,{children:[e.jsx(b,{value:"none",children:"None"}),_.filter(c=>c.id&&c.id.trim()!=="").map(c=>e.jsx(b,{value:c.id,children:c.name},c.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Date"}),e.jsx(O,{type:"date",value:de,onChange:c=>je(c.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Check In"}),e.jsx(O,{type:"time",value:me,onChange:c=>fe(c.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Check Out"}),e.jsx(O,{type:"time",value:J,onChange:c=>ye(c.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Snow Depth (inches)"}),e.jsx(O,{type:"number",step:"0.1",placeholder:"e.g., 3.5",value:se,onChange:c=>ve(c.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:N==="plow"?"Salt Used (lbs)":"Ice Melt (lbs)"}),e.jsx(O,{type:"number",step:"1",placeholder:"e.g., 50",value:N==="plow"?te:le,onChange:c=>N==="plow"?we(c.target.value):ge(c.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Weather Conditions"}),e.jsx(O,{placeholder:"e.g., Light snow, 28Â°F",value:he,onChange:c=>be(c.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Notes"}),e.jsx(Jt,{placeholder:"Additional notes...",value:ae,onChange:c=>Ce(c.target.value),rows:2})]})]}),e.jsxs(Ds,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(g,{type:"submit",disabled:M||!C||!$,children:[M&&e.jsx(De,{className:"h-4 w-4 mr-2 animate-spin"}),ne?"Update":"Create"]})]})]})]})})}var As="AlertDialog",[al]=At(As,[Ss]),X=Ss(),Ts=r=>{const{__scopeAlertDialog:i,...d}=r,h=X(i);return e.jsx(It,{...h,...d,modal:!0})};Ts.displayName=As;var nl="AlertDialogTrigger",rl=a.forwardRef((r,i)=>{const{__scopeAlertDialog:d,...h}=r,_=X(d);return e.jsx(Ht,{..._,...h,ref:i})});rl.displayName=nl;var il="AlertDialogPortal",Ms=r=>{const{__scopeAlertDialog:i,...d}=r,h=X(i);return e.jsx(Pt,{...h,...d})};Ms.displayName=il;var cl="AlertDialogOverlay",Es=a.forwardRef((r,i)=>{const{__scopeAlertDialog:d,...h}=r,_=X(d);return e.jsx(Wt,{..._,...h,ref:i})});Es.displayName=cl;var Ne="AlertDialogContent",[ol,dl]=al(Ne),ml=Mt("AlertDialogContent"),Ls=a.forwardRef((r,i)=>{const{__scopeAlertDialog:d,children:h,..._}=r,p=X(d),S=a.useRef(null),M=bs(i,S),N=a.useRef(null);return e.jsx(Ot,{contentName:Ne,titleName:$s,docsSlug:"alert-dialog",children:e.jsx(ol,{scope:d,cancelRef:N,children:e.jsxs(qt,{role:"alertdialog",...p,..._,ref:M,onOpenAutoFocus:Tt(_.onOpenAutoFocus,A=>{var C;A.preventDefault(),(C=N.current)==null||C.focus({preventScroll:!0})}),onPointerDownOutside:A=>A.preventDefault(),onInteractOutside:A=>A.preventDefault(),children:[e.jsx(ml,{children:h}),e.jsx(ul,{contentRef:S})]})})})});Ls.displayName=Ne;var $s="AlertDialogTitle",Is=a.forwardRef((r,i)=>{const{__scopeAlertDialog:d,...h}=r,_=X(d);return e.jsx(Rt,{..._,...h,ref:i})});Is.displayName=$s;var Ps="AlertDialogDescription",Os=a.forwardRef((r,i)=>{const{__scopeAlertDialog:d,...h}=r,_=X(d);return e.jsx(zt,{..._,...h,ref:i})});Os.displayName=Ps;var hl="AlertDialogAction",qs=a.forwardRef((r,i)=>{const{__scopeAlertDialog:d,...h}=r,_=X(d);return e.jsx(Ns,{..._,...h,ref:i})});qs.displayName=hl;var Rs="AlertDialogCancel",zs=a.forwardRef((r,i)=>{const{__scopeAlertDialog:d,...h}=r,{cancelRef:_}=dl(Rs,d),p=X(d),S=bs(i,_);return e.jsx(Ns,{...p,...h,ref:S})});zs.displayName=Rs;var ul=({contentRef:r})=>{const i=`\`${Ne}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Ne}\` by passing a \`${Ps}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ne}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return a.useEffect(()=>{var h;document.getElementById((h=r.current)==null?void 0:h.getAttribute("aria-describedby"))||console.warn(i)},[i,r]),null},pl=Ts,xl=Ms,Ws=Es,Hs=Ls,Fs=qs,Us=zs,Vs=Is,Bs=Os;const _l=pl,jl=xl,Ys=a.forwardRef(({className:r,...i},d)=>e.jsx(Ws,{className:oe("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...i,ref:d}));Ys.displayName=Ws.displayName;const Gs=a.forwardRef(({className:r,...i},d)=>e.jsxs(jl,{children:[e.jsx(Ys,{}),e.jsx(Hs,{ref:d,className:oe("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...i})]}));Gs.displayName=Hs.displayName;const Js=({className:r,...i})=>e.jsx("div",{className:oe("flex flex-col space-y-2 text-center sm:text-left",r),...i});Js.displayName="AlertDialogHeader";const Ks=({className:r,...i})=>e.jsx("div",{className:oe("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...i});Ks.displayName="AlertDialogFooter";const Zs=a.forwardRef(({className:r,...i},d)=>e.jsx(Vs,{ref:d,className:oe("text-lg font-semibold",r),...i}));Zs.displayName=Vs.displayName;const Qs=a.forwardRef(({className:r,...i},d)=>e.jsx(Bs,{ref:d,className:oe("text-sm text-muted-foreground",r),...i}));Qs.displayName=Bs.displayName;const Xs=a.forwardRef(({className:r,...i},d)=>e.jsx(Fs,{ref:d,className:oe(ks(),r),...i}));Xs.displayName=Fs.displayName;const et=a.forwardRef(({className:r,...i},d)=>e.jsx(Us,{ref:d,className:oe(ks({variant:"outline"}),"mt-2 sm:mt-0",r),...i}));et.displayName=Us.displayName;function ws({open:r,onOpenChange:i,title:d,description:h,onConfirm:_,isLoading:p=!1}){const S=async()=>{await _()};return e.jsx(_l,{open:r,onOpenChange:i,children:e.jsxs(Gs,{children:[e.jsxs(Js,{children:[e.jsx(Zs,{children:d}),e.jsx(Qs,{children:h})]}),e.jsxs(Ks,{children:[e.jsx(et,{disabled:p,children:"Cancel"}),e.jsxs(Xs,{onClick:S,disabled:p,className:"bg-red-600 hover:bg-red-700",children:[p&&e.jsx(De,{className:"h-4 w-4 mr-2 animate-spin"}),"Delete"]})]})]})})}function gs({photoPaths:r,onViewPhotos:i}){const[d,h]=a.useState([]),[_,p]=a.useState(!0);return a.useEffect(()=>{(async()=>{if(!r||r.length===0){p(!1);return}const M=[],N=r.slice(0,3);for(const A of N){if(A.startsWith("http")){M.push(A);continue}const{data:C,error:U}=await k.storage.from("work-photos").createSignedUrl(A,3600);!U&&(C!=null&&C.signedUrl)&&M.push(C.signedUrl)}h(M),p(!1)})()},[r]),!r||r.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):_?e.jsx(De,{className:"h-4 w-4 animate-spin text-muted-foreground"}):e.jsxs("div",{className:"flex items-center gap-1",children:[d.map((S,M)=>e.jsx("button",{onClick:()=>i(r),className:"h-8 w-8 rounded overflow-hidden border border-border/50 hover:ring-2 ring-primary transition-all flex-shrink-0",children:e.jsx("img",{src:S,alt:`Photo ${M+1}`,className:"h-full w-full object-cover",loading:"lazy"})},M)),r.length>3&&e.jsxs("button",{onClick:()=>i(r),className:"h-8 w-8 rounded bg-muted flex items-center justify-center text-xs font-medium text-muted-foreground hover:bg-muted/80 flex-shrink-0",children:["+",r.length-3]})]})}function $l(){const[r,i]=a.useState(!0),[d,h]=a.useState([]),[_,p]=a.useState([]),[S,M]=a.useState([]),[N,A]=a.useState([]),[C,U]=a.useState([]),[$,G]=a.useState(()=>v(sl(new Date),"yyyy-MM-dd")),[q,ee]=a.useState(()=>v(el(new Date),"yyyy-MM-dd")),[y,K]=a.useState("all"),[de,je]=a.useState("all"),[me,fe]=a.useState("all"),[J,ye]=a.useState("all"),[se,ve]=a.useState("all"),[te,we]=a.useState("all"),[le,ge]=a.useState(""),[he,be]=a.useState(""),[ae,Ce]=a.useState("current"),[V,ne]=a.useState(new Set),[E,c]=a.useState(new Set),[Le,ue]=a.useState(!1),[ke,$e]=a.useState(!1),[st,Ie]=a.useState(!1),[tt,Pe]=a.useState(!1),[Oe,ss]=a.useState("shifts"),[lt,ze]=a.useState(null),[I,We]=a.useState(null),[P,He]=a.useState(null),[Z,R]=a.useState(!1),[at,ts]=a.useState(!1),[pe,nt]=a.useState([]),[Fe,Ue]=a.useState(0),[ls,as]=a.useState(!1),rt=async s=>{if(s.length===0)return[];const l=[];for(const n of s){if(n.startsWith("http")){l.push(n);continue}const{data:o,error:t}=await k.storage.from("work-photos").createSignedUrl(n,3600);!t&&(o!=null&&o.signedUrl)&&l.push(o.signedUrl)}return l},ns=async s=>{if(!s||s.length===0)return;as(!0),ts(!0),Ue(0);const l=await rt(s);nt(l),as(!1)},it=()=>{Ue(s=>(s+1)%pe.length)},ct=()=>{Ue(s=>(s-1+pe.length)%pe.length)},re=async()=>{i(!0);try{const s=new Date($);s.setHours(0,0,0,0);const l=new Date(q);l.setHours(23,59,59,999);const[n,o,t,j,xe,T]=await Promise.all([k.from("time_clock").select("*, employee:employees(first_name, last_name)").gte("clock_in_time",s.toISOString()).lte("clock_in_time",l.toISOString()).order("clock_in_time",{ascending:!1}),k.from("work_logs").select("*, account:accounts(name), employee:employees(first_name, last_name), equipment:equipment(name)").gte("created_at",s.toISOString()).lte("created_at",l.toISOString()).order("created_at",{ascending:!1}),k.from("shovel_work_logs").select("*, account:accounts(name), employee:employees(first_name, last_name)").gte("created_at",s.toISOString()).lte("created_at",l.toISOString()).order("created_at",{ascending:!1}),k.from("accounts").select("id, name").eq("is_active",!0).order("name"),k.from("employees").select("id, first_name, last_name, category").eq("is_active",!0).order("first_name"),k.from("equipment").select("id, name").eq("is_active",!0).eq("status","available").order("name")]);h(n.data||[]),M(j.data||[]),A(xe.data||[]),U(T.data||[]);const L=(o.data||[]).map(m=>{var _e,Ae;return{id:m.id,type:"plow",date:m.created_at,check_in_time:m.check_in_time,check_out_time:m.check_out_time,account_id:m.account_id,account_name:((_e=m.account)==null?void 0:_e.name)||"Unknown",employee_id:m.employee_id||"",service_type:m.service_type,snow_depth_inches:m.snow_depth_inches,salt_used_lbs:m.salt_used_lbs,ice_melt_used_lbs:null,weather_conditions:m.weather_conditions,equipment_id:m.equipment_id,equipment_name:((Ae=m.equipment)==null?void 0:Ae.name)||null,employee_name:m.employee?`${m.employee.first_name} ${m.employee.last_name}`:"Unknown",team_member_names:[],photo_urls:m.photo_urls,notes:m.notes,billed:m.billed||!1}}),Nt=t.data||[],Dt=await Promise.all(Nt.map(async m=>{var Ae;let _e=[];if(m.team_member_ids&&m.team_member_ids.length>0){const{data:Ct}=await k.from("employees").select("first_name, last_name").in("id",m.team_member_ids);_e=(Ct||[]).map(us=>`${us.first_name} ${us.last_name}`)}return{id:m.id,type:"shovel",date:m.created_at,check_in_time:m.check_in_time,check_out_time:m.check_out_time,account_id:m.account_id,account_name:((Ae=m.account)==null?void 0:Ae.name)||"Unknown",employee_id:m.employee_id||"",service_type:m.service_type,snow_depth_inches:m.snow_depth_inches,salt_used_lbs:null,ice_melt_used_lbs:m.ice_melt_used_lbs,weather_conditions:m.weather_conditions,equipment_id:null,equipment_name:null,employee_name:m.employee?`${m.employee.first_name} ${m.employee.last_name}`:"Unknown",team_member_names:_e,photo_urls:m.photo_urls,notes:m.notes,billed:m.billed||!1}}));p([...L,...Dt].sort((m,_e)=>new Date(_e.date).getTime()-new Date(m.date).getTime()))}catch(s){console.error("Error fetching report data:",s),D.error("Failed to load report data")}finally{i(!1)}};a.useEffect(()=>{re()},[$,q]);const B=a.useMemo(()=>d.filter(s=>!(J!=="all"&&s.employee_id!==J)),[d,J]),f=a.useMemo(()=>_.filter(s=>{if(ae==="current"&&s.billed||ae==="archived"&&!s.billed||y!=="all"&&s.type!==y||se!=="all"&&s.service_type!==se)return!1;if(s.type==="plow"&&de!=="all"){const l=S.find(n=>n.id===de);if(l&&s.account_name!==l.name)return!1}if(s.type==="shovel"&&me!=="all"){const l=S.find(n=>n.id===me);if(l&&s.account_name!==l.name)return!1}if(J!=="all"){const l=N.find(n=>n.id===J);if(l&&s.employee_name!==`${l.first_name} ${l.last_name}`)return!1}if(te!=="all"&&s.type==="plow"){const l=C.find(n=>n.id===te);if(l&&s.equipment_name!==l.name)return!1}if(le&&s.snow_depth_inches!==null&&s.snow_depth_inches<parseFloat(le))return!1;if(he){const l=s.type==="plow"?s.salt_used_lbs:s.ice_melt_used_lbs;if(l!==null&&l<parseFloat(he))return!1}return!0}),[_,y,de,me,J,se,te,le,he,S,N,C,ae]),ot=a.useMemo(()=>_.filter(s=>!s.billed).length,[_]),dt=a.useMemo(()=>_.filter(s=>s.billed).length,[_]),Y=a.useMemo(()=>{const s=f.filter(t=>t.type==="plow").length,l=f.filter(t=>t.type==="shovel").length,n=f.filter(t=>t.service_type==="salt"||t.service_type==="both"||t.service_type==="ice_melt").length,o=new Set(f.map(t=>t.account_name)).size;return{total:f.length,plow:s,shovel:l,salt:n,locations:o}},[f]),mt=()=>{K("all"),je("all"),fe("all"),ye("all"),ve("all"),we("all"),ge(""),be("")},Ve=(s,l)=>{if(!s||!l)return"-";const n=Me(new Date(l),new Date(s)),o=Math.floor(n/60),t=n%60;return`${o}h ${t}m`},rs=(s,l)=>!s||!l?"-":`${(Me(new Date(l),new Date(s))/60).toFixed(1)}h`,ht=()=>{is(),setTimeout(()=>{window.print()},500)},is=()=>{const s=f.map(t=>{const j=t.type==="shovel"&&t.team_member_names&&t.team_member_names.length>0?t.team_member_names.join(", "):t.employee_name;return{id:t.id,type:t.type,date:v(new Date(t.date),"MM/dd/yy"),checkIn:t.check_in_time?v(new Date(t.check_in_time),"HH:mm"):"-",checkOut:t.check_out_time?v(new Date(t.check_out_time),"HH:mm"):"-",duration:Ve(t.check_in_time,t.check_out_time),account:t.account_name,serviceType:t.service_type,snowDepth:t.snow_depth_inches?`${t.snow_depth_inches}"`:"-",saltLbs:t.salt_used_lbs?`${t.salt_used_lbs}lb`:t.ice_melt_used_lbs?`${t.ice_melt_used_lbs}lb`:"-",equipment:t.equipment_name||"-",employee:j,conditions:t.weather_conditions||"-",notes:t.notes||void 0}});f.reduce((t,j)=>j.check_in_time&&j.check_out_time?t+Me(new Date(j.check_out_time),new Date(j.check_in_time))/60:t,0);const l=new Set(f.map(t=>t.account_name)).size,n=f.filter(t=>t.service_type==="plow"||t.service_type==="both").length,o=f.filter(t=>t.service_type==="salt"||t.service_type==="ice_melt"||t.service_type==="both").length;Gt(s,{totalJobs:Y.total,totalSaltLbs:f.reduce((t,j)=>t+(j.salt_used_lbs||0),0),totalIceMeltLbs:f.reduce((t,j)=>t+(j.ice_melt_used_lbs||0),0),plowCount:n,saltCount:o,propertyCount:l,dateRange:`${v(new Date($),"yyyy-MM-dd")} to ${v(new Date(q),"yyyy-MM-dd")}`}),D.success("PDF exported successfully")},ut=()=>{const s=["Employee","Date","Clock In","Clock Out","Hours Worked","Location"],l=B.map(j=>{const xe=j.employee?`${j.employee.first_name} ${j.employee.last_name}`:"Unknown",T=rs(j.clock_in_time,j.clock_out_time),L=j.clock_in_latitude&&j.clock_in_longitude?`${j.clock_in_latitude.toFixed(4)}, ${j.clock_in_longitude.toFixed(4)}`:"-";return[xe,v(new Date(j.clock_in_time),"MM/dd/yyyy"),v(new Date(j.clock_in_time),"HH:mm"),j.clock_out_time?v(new Date(j.clock_out_time),"HH:mm"):"-",T,L]}),n=[s,...l].map(j=>j.join(",")).join(`
`),o=new Blob([n],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(o),t.download=`timesheets_${v(new Date($),"yyyy-MM-dd")}_to_${v(new Date(q),"yyyy-MM-dd")}.csv`,t.click(),D.success("Time sheets exported successfully")},pt=()=>{const s=B.reduce((T,L)=>L.clock_in_time&&L.clock_out_time?T+Me(new Date(L.clock_out_time),new Date(L.clock_in_time))/60:T,0),l=f.reduce((T,L)=>L.check_in_time&&L.check_out_time?T+Me(new Date(L.check_out_time),new Date(L.check_in_time))/60:T,0),n=new Set([...B.map(T=>T.employee_id),...f.map(T=>T.employee_id)].filter(Boolean)).size,t=[["WinterWatch-Pro Summary Report"],[`Period: ${v(new Date($),"MM/dd/yyyy")} to ${v(new Date(q),"MM/dd/yyyy")}`],[`Generated: ${v(new Date,"MM/dd/yyyy HH:mm")}`],[""],["TIME CLOCK SUMMARY"],["Total Shifts",B.length.toString()],["Total Hours",s.toFixed(1)],[""],["WORK LOG SUMMARY"],["Total Jobs",Y.total.toString()],["Plow Jobs",Y.plow.toString()],["Shovel Jobs",Y.shovel.toString()],["Salt Applications",Y.salt.toString()],["Total Work Hours",l.toFixed(1)],["Unique Locations",Y.locations.toString()],[""],["OVERALL"],["Active Employees",n.toString()],["Total Salt Used (lbs)",f.reduce((T,L)=>T+(L.salt_used_lbs||0),0).toString()],["Total Ice Melt Used (lbs)",f.reduce((T,L)=>T+(L.ice_melt_used_lbs||0),0).toString()]].map(T=>T.join(",")).join(`
`),j=new Blob([t],{type:"text/csv;charset=utf-8;"}),xe=document.createElement("a");xe.href=URL.createObjectURL(j),xe.download=`summary_${v(new Date($),"yyyy-MM-dd")}_to_${v(new Date(q),"yyyy-MM-dd")}.csv`,xe.click(),D.success("Summary report exported successfully")},xt=()=>{V.size===B.length?ne(new Set):ne(new Set(B.map(s=>s.id)))},cs=()=>{E.size===f.length?c(new Set):c(new Set(f.map(s=>s.id)))},_t=async s=>{R(!0);try{const l=new Date(`${s.clock_in_date}T${s.clock_in_time}`),n=s.clock_out_time?new Date(`${s.clock_in_date}T${s.clock_out_time}`):null;if(s.id){const{error:o}=await k.from("time_clock").update({employee_id:s.employee_id,clock_in_time:l.toISOString(),clock_out_time:(n==null?void 0:n.toISOString())||null}).eq("id",s.id);if(o)throw o;D.success("Shift updated successfully")}else{const{error:o}=await k.from("time_clock").insert({employee_id:s.employee_id,clock_in_time:l.toISOString(),clock_out_time:(n==null?void 0:n.toISOString())||null});if(o)throw o;D.success("Shift created successfully")}ue(!1),ze(null),await re()}catch(l){console.error("Error saving shift:",l),D.error("Failed to save shift")}finally{R(!1)}},jt=async s=>{R(!0);try{const l=s.check_in_time?new Date(`${s.date}T${s.check_in_time}`):null,n=s.check_out_time?new Date(`${s.date}T${s.check_out_time}`):null;if(s.type==="plow"){const o={account_id:s.account_id,employee_id:s.employee_id,equipment_id:s.equipment_id||null,service_type:s.service_type,status:"completed",check_in_time:(l==null?void 0:l.toISOString())||null,check_out_time:(n==null?void 0:n.toISOString())||null,snow_depth_inches:s.snow_depth_inches||null,salt_used_lbs:s.salt_used_lbs||null,weather_conditions:s.weather_conditions||null,notes:s.notes||null};if(s.id){const{error:t}=await k.from("work_logs").update(o).eq("id",s.id);if(t)throw t;D.success("Work log updated successfully")}else{const{error:t}=await k.from("work_logs").insert(o);if(t)throw t;D.success("Work log created successfully")}}else{const o={account_id:s.account_id,employee_id:s.employee_id,service_type:s.service_type,status:"completed",check_in_time:(l==null?void 0:l.toISOString())||null,check_out_time:(n==null?void 0:n.toISOString())||null,snow_depth_inches:s.snow_depth_inches||null,ice_melt_used_lbs:s.ice_melt_used_lbs||null,weather_conditions:s.weather_conditions||null,notes:s.notes||null};if(s.id){const{error:t}=await k.from("shovel_work_logs").update(o).eq("id",s.id);if(t)throw t;D.success("Work log updated successfully")}else{const{error:t}=await k.from("shovel_work_logs").insert(o);if(t)throw t;D.success("Work log created successfully")}}$e(!1),We(null),await re()}catch(l){console.error("Error saving work log:",l),D.error("Failed to save work log")}finally{R(!1)}},ft=async()=>{if(P){R(!0);try{if(P.type==="shift"){const{error:s}=await k.from("time_clock").delete().eq("id",P.id);if(s)throw s;D.success("Shift deleted successfully")}else{const s=_.find(l=>l.id===P.id);if(s){const l=s.type==="plow"?"work_logs":"shovel_work_logs",{error:n}=await k.from(l).delete().eq("id",P.id);if(n)throw n;D.success("Work log deleted successfully")}}Ie(!1),He(null),await re()}catch(s){console.error("Error deleting:",s),D.error("Failed to delete")}finally{R(!1)}}},yt=async()=>{R(!0);try{if(Oe==="shifts"){const s=Array.from(V);if(s.length===0)return;const{error:l}=await k.from("time_clock").delete().in("id",s);if(l)throw l;D.success(`${s.length} shift(s) deleted successfully`),ne(new Set)}else{const s=Array.from(E);if(s.length===0)return;const l=_.filter(o=>s.includes(o.id)&&o.type==="plow").map(o=>o.id),n=_.filter(o=>s.includes(o.id)&&o.type==="shovel").map(o=>o.id);if(l.length>0){const{error:o}=await k.from("work_logs").delete().in("id",l);if(o)throw o}if(n.length>0){const{error:o}=await k.from("shovel_work_logs").delete().in("id",n);if(o)throw o}D.success(`${s.length} work log(s) deleted successfully`),c(new Set)}Pe(!1),await re()}catch(s){console.error("Error bulk deleting:",s),D.error("Failed to delete selected items")}finally{R(!1)}},vt=()=>{ss("shifts"),Pe(!0)},wt=()=>{ss("worklogs"),Pe(!0)},os=async s=>{const l=Array.from(E);if(l.length!==0){R(!0);try{const n=_.filter(t=>l.includes(t.id)&&t.type==="plow").map(t=>t.id),o=_.filter(t=>l.includes(t.id)&&t.type==="shovel").map(t=>t.id);if(n.length>0){const{error:t}=await k.from("work_logs").update({billed:s}).in("id",n);if(t)throw t}if(o.length>0){const{error:t}=await k.from("shovel_work_logs").update({billed:s}).in("id",o);if(t)throw t}D.success(`${l.length} work log(s) marked as ${s?"billed":"unbilled"}`),c(new Set),await re()}catch(n){console.error("Error updating billed status:",n),D.error("Failed to update billed status")}finally{R(!1)}}},ds=async s=>{R(!0);try{const l=s.type==="plow"?"work_logs":"shovel_work_logs",{error:n}=await k.from(l).update({billed:!s.billed}).eq("id",s.id);if(n)throw n;D.success(`Work log marked as ${s.billed?"unbilled":"billed"}`),await re()}catch(l){console.error("Error toggling billed status:",l),D.error("Failed to update billed status")}finally{R(!1)}},gt=()=>{ze(null),ue(!0)},bt=s=>{ze(s),ue(!0)},kt=s=>{const l=s.employee?`${s.employee.first_name} ${s.employee.last_name}`:"Unknown";He({type:"shift",id:s.id,name:l}),Ie(!0)},St=()=>{We(null),$e(!0)},ms=s=>{We(s),$e(!0)},hs=s=>{He({type:"worklog",id:s.id,name:s.account_name}),Ie(!0)};return r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(De,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/20 flex items-center justify-center",children:e.jsx(Re,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Service Reports"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"View, edit, and export work logs"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:ht,children:[e.jsx(Xt,{className:"h-4 w-4 mr-1"}),"Print"]}),e.jsxs(Ft,{children:[e.jsx(Ut,{asChild:!0,children:e.jsxs(g,{size:"sm",className:"bg-primary hover:bg-primary/90",children:[e.jsx(_s,{className:"h-4 w-4 mr-1"}),"Export",e.jsx(Kt,{className:"h-3 w-3 ml-1"})]})}),e.jsxs(Vt,{align:"end",children:[e.jsxs(Je,{onClick:is,children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Export Work Logs PDF"]}),e.jsxs(Je,{onClick:ut,children:[e.jsx(js,{className:"h-4 w-4 mr-2"}),"Export Time Sheets"]}),e.jsxs(Je,{onClick:pt,children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Export Summary Report"]})]})]}),e.jsx(g,{size:"sm",variant:"outline",onClick:re,children:e.jsx(Zt,{className:"h-4 w-4"})})]})]}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/80 border-border/50",children:e.jsxs(ce,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Yt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Report Filters"})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"From Date"}),e.jsx(O,{type:"date",value:$,onChange:s=>G(s.target.value),className:"bg-[hsl(var(--background))] border-border/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"To Date"}),e.jsx(O,{type:"date",value:q,onChange:s=>ee(s.target.value),className:"bg-[hsl(var(--background))] border-border/50"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Log Type"}),e.jsxs(z,{value:y,onValueChange:K,children:[e.jsx(W,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Types"})}),e.jsxs(F,{children:[e.jsx(b,{value:"all",children:"All Types"}),e.jsx(b,{value:"plow",children:"Plow Only"}),e.jsx(b,{value:"shovel",children:"Shovel Only"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Account (Plow)"}),e.jsxs(z,{value:de,onValueChange:je,children:[e.jsx(W,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Accounts"})}),e.jsxs(F,{children:[e.jsx(b,{value:"all",children:"All Accounts"}),S.filter(s=>s.id&&s.id.trim()!=="").map(s=>e.jsx(b,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Location (Shovel)"}),e.jsxs(z,{value:me,onValueChange:fe,children:[e.jsx(W,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Locations"})}),e.jsxs(F,{children:[e.jsx(b,{value:"all",children:"All Locations"}),S.filter(s=>s.id&&s.id.trim()!=="").map(s=>e.jsx(b,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Employee"}),e.jsxs(z,{value:J,onValueChange:ye,children:[e.jsx(W,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Employees"})}),e.jsxs(F,{children:[e.jsx(b,{value:"all",children:"All Employees"}),N.filter(s=>s.id&&s.id.trim()!=="").map(s=>e.jsxs(b,{value:s.id,children:[s.first_name," ",s.last_name]},s.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Service Type"}),e.jsxs(z,{value:se,onValueChange:ve,children:[e.jsx(W,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Types"})}),e.jsxs(F,{children:[e.jsx(b,{value:"all",children:"All Types"}),e.jsx(b,{value:"plow",children:"Plow"}),e.jsx(b,{value:"salt",children:"Salt"}),e.jsx(b,{value:"both",children:"Plow/Salt"}),e.jsx(b,{value:"shovel",children:"Shovel Walks"}),e.jsx(b,{value:"ice_melt",children:"Salt Walks"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Equipment"}),e.jsxs(z,{value:te,onValueChange:we,children:[e.jsx(W,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Equipment"})}),e.jsxs(F,{children:[e.jsx(b,{value:"all",children:"All Equipment"}),C.filter(s=>s.id&&s.id.trim()!=="").map(s=>e.jsx(b,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Min Snow (in)"}),e.jsx(O,{type:"number",placeholder:"Any",value:le,onChange:s=>ge(s.target.value),className:"bg-[hsl(var(--background))] border-border/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Min Salt (lbs)"}),e.jsx(O,{type:"number",placeholder:"Any",value:he,onChange:s=>be(s.target.value),className:"bg-[hsl(var(--background))] border-border/50"})]})]}),e.jsx("div",{className:"text-center",children:e.jsx(g,{variant:"link",className:"text-muted-foreground text-sm",onClick:mt,children:"Clear All Filters"})})]})]})}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/80 border-border/50",children:e.jsxs(ce,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:["Daily Shifts (",B.length," shifts)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[V.size>0&&e.jsxs(g,{size:"sm",variant:"destructive",onClick:vt,children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"Delete (",V.size,")"]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:gt,children:[e.jsx(fs,{className:"h-4 w-4 mr-1"}),"Add Shift"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Be,{children:[e.jsx(Ye,{children:e.jsxs(Q,{className:"border-border/50",children:[e.jsx(x,{className:"w-10",children:e.jsx(Se,{checked:V.size===B.length&&B.length>0,onCheckedChange:xt})}),e.jsx(x,{children:"Employee"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Start"}),e.jsx(x,{children:"End"}),e.jsx(x,{children:"Hours"}),e.jsx(x,{children:"Location"}),e.jsx(x,{children:"Actions"})]})}),e.jsxs(Ge,{children:[B.slice(0,10).map(s=>e.jsxs(Q,{className:"border-border/30",children:[e.jsx(u,{children:e.jsx(Se,{checked:V.has(s.id),onCheckedChange:l=>{const n=new Set(V);l?n.add(s.id):n.delete(s.id),ne(n)}})}),e.jsx(u,{className:"font-medium",children:s.employee?`${s.employee.first_name} ${s.employee.last_name}`:"Unknown"}),e.jsx(u,{children:v(new Date(s.clock_in_time),"MM/dd")}),e.jsx(u,{children:v(new Date(s.clock_in_time),"HH:mm")}),e.jsx(u,{children:s.clock_out_time?v(new Date(s.clock_out_time),"HH:mm"):"-"}),e.jsx(u,{children:e.jsx("span",{className:"text-cyan-400 cursor-pointer hover:underline",children:rs(s.clock_in_time,s.clock_out_time)})}),e.jsx(u,{children:s.clock_in_latitude&&s.clock_in_longitude?e.jsxs(g,{variant:"link",size:"sm",className:"text-cyan-400 p-0 h-auto",children:[e.jsx(Et,{className:"h-3 w-3 mr-1"}),"View"]}):"-"}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>bt(s),children:e.jsx(Ke,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>kt(s),children:e.jsx(Te,{className:"h-3 w-3 text-red-400"})})]})})]},s.id)),B.length===0&&e.jsx(Q,{children:e.jsx(u,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No shifts found for the selected filters"})})]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsx(ie,{className:"bg-[hsl(var(--card))]/50 border-border/30",children:e.jsxs(ce,{className:"py-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total"}),e.jsx("p",{className:"text-3xl font-bold",children:Y.total})]})}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/50 border-border/30",children:e.jsxs(ce,{className:"py-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Plow"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:Y.plow})]})}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/50 border-border/30",children:e.jsxs(ce,{className:"py-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Shovel"}),e.jsx("p",{className:"text-3xl font-bold text-purple-400",children:Y.shovel})]})}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/50 border-border/30",children:e.jsxs(ce,{className:"py-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Salt"}),e.jsx("p",{className:"text-3xl font-bold text-green-400",children:Y.salt})]})}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/50 border-border/30",children:e.jsxs(ce,{className:"py-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Locations"}),e.jsx("p",{className:"text-3xl font-bold text-orange-400",children:Y.locations})]})})]}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/80 border-border/50",children:e.jsx(ce,{className:"pt-6",children:e.jsxs(Lt,{value:ae,onValueChange:s=>{Ce(s),c(new Set)},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs($t,{children:[e.jsxs(ps,{value:"current",className:"gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Current (",ot,")"]}),e.jsxs(ps,{value:"archived",className:"gap-2",children:[e.jsx(ys,{className:"h-4 w-4"}),"Archived (",dt,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E.size>0&&e.jsxs(e.Fragment,{children:[ae==="current"?e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>os(!0),disabled:Z,children:[e.jsx(vs,{className:"h-4 w-4 mr-1"}),"Mark Billed (",E.size,")"]}):e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>os(!1),disabled:Z,children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),"Unarchive (",E.size,")"]}),e.jsxs(g,{size:"sm",variant:"destructive",onClick:wt,disabled:Z,children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"Delete (",E.size,")"]})]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:St,children:[e.jsx(fs,{className:"h-4 w-4 mr-1"}),"Add Entry"]})]})]}),e.jsx(xs,{value:"current",className:"mt-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Be,{children:[e.jsx(Ye,{children:e.jsxs(Q,{className:"border-border/50",children:[e.jsx(x,{className:"w-10",children:e.jsx(Se,{checked:E.size===f.length&&f.length>0,onCheckedChange:cs})}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"In"}),e.jsx(x,{children:"Out"}),e.jsx(x,{children:"Dur."}),e.jsx(x,{children:"Location"}),e.jsx(x,{children:"Service"}),e.jsx(x,{children:"Snow/Salt"}),e.jsx(x,{children:"Weather"}),e.jsx(x,{children:"Equipment"}),e.jsx(x,{children:"Crew"}),e.jsx(x,{children:"Photo"}),e.jsx(x,{children:"Actions"})]})}),e.jsxs(Ge,{children:[f.slice(0,50).map(s=>e.jsxs(Q,{className:"border-border/30",children:[e.jsx(u,{children:e.jsx(Se,{checked:E.has(s.id),onCheckedChange:l=>{const n=new Set(E);l?n.add(s.id):n.delete(s.id),c(n)}})}),e.jsx(u,{children:e.jsx(qe,{className:s.type==="plow"?"bg-blue-600":"bg-purple-600",children:s.type==="plow"?"Plow":"Shov"})}),e.jsx(u,{children:v(new Date(s.date),"MM/dd")}),e.jsx(u,{children:s.check_in_time?v(new Date(s.check_in_time),"HH:mm"):"-"}),e.jsx(u,{children:s.check_out_time?v(new Date(s.check_out_time),"HH:mm"):"-"}),e.jsx(u,{children:Ve(s.check_in_time,s.check_out_time)}),e.jsx(u,{className:"max-w-[100px] truncate",title:s.account_name,children:s.account_name}),e.jsx(u,{children:e.jsx(qe,{variant:"outline",className:s.service_type==="plow"?"border-blue-500 text-blue-400":s.service_type==="salt"||s.service_type==="ice_melt"?"border-green-500 text-green-400":s.service_type==="shovel"?"border-purple-500 text-purple-400":"border-cyan-500 text-cyan-400",children:s.type==="plow"?s.service_type==="both"?"Plow/Salt":s.service_type==="plow"?"Plow":s.service_type==="salt"?"Salt":s.service_type:s.service_type==="both"?"Shovel/Salt":s.service_type==="ice_melt"?"Salt":s.service_type==="shovel"?"Shovel":s.service_type})}),e.jsxs(u,{className:"text-sm",children:[s.snow_depth_inches!==null?`${s.snow_depth_inches}"`:"-"," / "," ",s.salt_used_lbs!==null?`${s.salt_used_lbs}lb`:s.ice_melt_used_lbs!==null?`${s.ice_melt_used_lbs}lb`:"-"]}),e.jsx(u,{className:"max-w-[80px] truncate text-sm",title:s.weather_conditions||"-",children:s.weather_conditions||"-"}),e.jsx(u,{className:"max-w-[80px] truncate text-sm",title:s.equipment_name||"-",children:s.equipment_name||"-"}),e.jsx(u,{className:"max-w-[100px] truncate text-sm",title:s.team_member_names.join(", ")||s.employee_name,children:s.team_member_names.length>0?s.team_member_names.join(", "):s.employee_name}),e.jsx(u,{children:e.jsx(gs,{photoPaths:s.photo_urls||[],onViewPhotos:ns})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>ds(s),title:"Mark as billed",disabled:Z,children:e.jsx(vs,{className:"h-3 w-3 text-green-500"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>ms(s),children:e.jsx(Ke,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>hs(s),children:e.jsx(Te,{className:"h-3 w-3 text-red-400"})})]})})]},s.id)),f.length===0&&e.jsx(Q,{children:e.jsx(u,{colSpan:14,className:"text-center text-muted-foreground py-8",children:"No unbilled work logs found"})})]})]})})}),e.jsx(xs,{value:"archived",className:"mt-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Be,{children:[e.jsx(Ye,{children:e.jsxs(Q,{className:"border-border/50",children:[e.jsx(x,{className:"w-10",children:e.jsx(Se,{checked:E.size===f.length&&f.length>0,onCheckedChange:cs})}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"In"}),e.jsx(x,{children:"Out"}),e.jsx(x,{children:"Dur."}),e.jsx(x,{children:"Location"}),e.jsx(x,{children:"Service"}),e.jsx(x,{children:"Snow/Salt"}),e.jsx(x,{children:"Weather"}),e.jsx(x,{children:"Equipment"}),e.jsx(x,{children:"Crew"}),e.jsx(x,{children:"Photo"}),e.jsx(x,{children:"Actions"})]})}),e.jsxs(Ge,{children:[f.slice(0,50).map(s=>e.jsxs(Q,{className:"border-border/30 opacity-75",children:[e.jsx(u,{children:e.jsx(Se,{checked:E.has(s.id),onCheckedChange:l=>{const n=new Set(E);l?n.add(s.id):n.delete(s.id),c(n)}})}),e.jsx(u,{children:e.jsx(qe,{className:s.type==="plow"?"bg-blue-600":"bg-purple-600",children:s.type==="plow"?"Plow":"Shov"})}),e.jsx(u,{children:v(new Date(s.date),"MM/dd")}),e.jsx(u,{children:s.check_in_time?v(new Date(s.check_in_time),"HH:mm"):"-"}),e.jsx(u,{children:s.check_out_time?v(new Date(s.check_out_time),"HH:mm"):"-"}),e.jsx(u,{children:Ve(s.check_in_time,s.check_out_time)}),e.jsx(u,{className:"max-w-[100px] truncate",title:s.account_name,children:s.account_name}),e.jsx(u,{children:e.jsx(qe,{variant:"outline",className:s.service_type==="plow"?"border-blue-500 text-blue-400":s.service_type==="salt"||s.service_type==="ice_melt"?"border-green-500 text-green-400":s.service_type==="shovel"?"border-purple-500 text-purple-400":"border-cyan-500 text-cyan-400",children:s.type==="plow"?s.service_type==="both"?"Plow/Salt":s.service_type==="plow"?"Plow":s.service_type==="salt"?"Salt":s.service_type:s.service_type==="both"?"Shovel/Salt":s.service_type==="ice_melt"?"Salt":s.service_type==="shovel"?"Shovel":s.service_type})}),e.jsxs(u,{className:"text-sm",children:[s.snow_depth_inches!==null?`${s.snow_depth_inches}"`:"-"," / "," ",s.salt_used_lbs!==null?`${s.salt_used_lbs}lb`:s.ice_melt_used_lbs!==null?`${s.ice_melt_used_lbs}lb`:"-"]}),e.jsx(u,{className:"max-w-[80px] truncate text-sm",title:s.weather_conditions||"-",children:s.weather_conditions||"-"}),e.jsx(u,{className:"max-w-[80px] truncate text-sm",title:s.equipment_name||"-",children:s.equipment_name||"-"}),e.jsx(u,{className:"max-w-[100px] truncate text-sm",title:s.team_member_names.join(", ")||s.employee_name,children:s.team_member_names.length>0?s.team_member_names.join(", "):s.employee_name}),e.jsx(u,{children:e.jsx(gs,{photoPaths:s.photo_urls||[],onViewPhotos:ns})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>ds(s),title:"Mark as unbilled",disabled:Z,children:e.jsx(ys,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>ms(s),children:e.jsx(Ke,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>hs(s),children:e.jsx(Te,{className:"h-3 w-3 text-red-400"})})]})})]},s.id)),f.length===0&&e.jsx(Q,{children:e.jsx(u,{colSpan:14,className:"text-center text-muted-foreground py-8",children:"No archived work logs found"})})]})]})})})]})})}),e.jsx(tl,{open:Le,onOpenChange:ue,employees:N,initialData:lt,onSave:_t,isLoading:Z}),e.jsx(ll,{open:ke,onOpenChange:$e,accounts:S,employees:N,equipment:C,initialData:I?{id:I.id,type:I.type,account_id:I.account_id,employee_id:I.employee_id,equipment_id:I.equipment_id||void 0,service_type:I.service_type,check_in_time:I.check_in_time,check_out_time:I.check_out_time,snow_depth_inches:I.snow_depth_inches,salt_used_lbs:I.salt_used_lbs,ice_melt_used_lbs:I.ice_melt_used_lbs,weather_conditions:I.weather_conditions,notes:I.notes}:null,onSave:jt,isLoading:Z}),e.jsx(ws,{open:st,onOpenChange:Ie,title:(P==null?void 0:P.type)==="shift"?"Delete Shift":"Delete Work Log",description:`Are you sure you want to delete this ${(P==null?void 0:P.type)==="shift"?"shift":"work log"} for "${P==null?void 0:P.name}"? This action cannot be undone.`,onConfirm:ft,isLoading:Z}),e.jsx(ws,{open:tt,onOpenChange:Pe,title:Oe==="shifts"?`Delete ${V.size} Shifts`:`Delete ${E.size} Work Logs`,description:`Are you sure you want to delete ${Oe==="shifts"?V.size:E.size} selected ${Oe==="shifts"?"shift(s)":"work log(s)"}? This action cannot be undone.`,onConfirm:yt,isLoading:Z}),e.jsx(Ze,{open:at,onOpenChange:ts,children:e.jsxs(Qe,{className:"max-w-3xl",children:[e.jsx(Xe,{children:e.jsx(es,{children:ls?"Loading photos...":`Photo ${Fe+1} of ${pe.length}`})}),ls?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(De,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):pe.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:pe[Fe],alt:`Photo ${Fe+1}`,className:"w-full h-auto max-h-[70vh] object-contain rounded-lg"}),pe.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"secondary",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2",onClick:ct,children:e.jsx(Qt,{className:"h-4 w-4"})}),e.jsx(g,{variant:"secondary",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2",onClick:it,children:e.jsx(Bt,{className:"h-4 w-4"})})]})]}):e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No photos available"})]})})]})}export{$l as default};
