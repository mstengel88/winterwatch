import{r as l,j as e,L as F,U as u,T as Q,i as W,k as L,l as P,C as m,b as h,B as g,I as x,c as i,s as j,f as d}from"./index-BTTndiCa.js";import{B as f,S as I,a as A,b as U,c as k,d as _}from"./select-CkuTWz4P.js";import{D as X,a as Y,b as Z,c as ee,d as se,e as ae}from"./dialog-DzHIB3n4.js";import{d as re,e as te,f as le,i as M}from"./index-C_FqIwIg.js";import{U as oe,E as ne,e as ce,g as ie}from"./validations-xPfDVGkZ.js";import{S as de}from"./search-CUdo4Vh7.js";import{P as me}from"./plus-DnkJBOXp.js";import{T as R}from"./truck-GV-QDD0s.js";import{S as he}from"./shovel-CsAXD17G.js";import{P as xe}from"./pencil-VyY2SQ7L.js";import{T as pe}from"./trash-2-RpLMvkye.js";import"./Combination-BI3QGdrN.js";const ue=["plow","shovel","both"];function De(){const[o,V]=l.useState([]),[B,O]=l.useState([]),[z,C]=l.useState(!0),[$,y]=l.useState(!1),[p,S]=l.useState(null),[E,D]=l.useState(!1),[N,q]=l.useState(""),[H,G]=l.useState("employees"),[r,n]=l.useState({first_name:"",last_name:"",email:"",phone:"",category:"both",hourly_rate:"",user_id:""}),b=async()=>{C(!0);try{const[s,a]=await Promise.all([j.from("employees").select("*").order("last_name"),j.from("profiles").select("*")]);if(s.error)throw s.error;if(a.error)throw a.error;V(s.data||[]),O(a.data||[])}catch(s){console.error("Error fetching data:",s),d.error("Failed to load employees")}finally{C(!1)}};l.useEffect(()=>{b()},[]);const T=s=>{var a;s?(S(s),n({first_name:s.first_name,last_name:s.last_name,email:s.email||"",phone:s.phone||"",category:s.category,hourly_rate:((a=s.hourly_rate)==null?void 0:a.toString())||"",user_id:s.user_id||""})):(S(null),n({first_name:"",last_name:"",email:"",phone:"",category:"both",hourly_rate:"",user_id:""})),y(!0)},J=async()=>{const s=ce.safeParse(r);if(!s.success){d.error(ie(s.error));return}D(!0);try{const a=s.data,c={first_name:a.first_name,last_name:a.last_name,email:a.email||null,phone:a.phone||null,category:a.category,hourly_rate:a.hourly_rate?parseFloat(a.hourly_rate):null,user_id:a.user_id||null};if(p){const{error:t}=await j.from("employees").update(c).eq("id",p.id);if(t)throw t;d.success("Employee updated")}else{const{error:t}=await j.from("employees").insert(c);if(t)throw t;d.success("Employee created")}y(!1),b()}catch(a){console.error("Error saving employee:",a),d.error("Failed to save employee")}finally{D(!1)}},K=async s=>{if(confirm("Are you sure you want to delete this employee?"))try{const{error:a}=await j.from("employees").delete().eq("id",s);if(a)throw a;d.success("Employee deleted"),b()}catch(a){console.error("Error deleting employee:",a),d.error("Failed to delete employee")}},w=l.useMemo(()=>{if(!N)return o;const s=N.toLowerCase();return o.filter(a=>{var c;return`${a.first_name} ${a.last_name}`.toLowerCase().includes(s)||((c=a.email)==null?void 0:c.toLowerCase().includes(s))})},[o,N]),v=l.useMemo(()=>{const s=o.filter(t=>t.is_active).length,a=o.filter(t=>t.category==="plow"||t.category==="both").length,c=o.filter(t=>t.category==="shovel"||t.category==="both").length;return{total:o.length,active:s,plow:a,shovel:c}},[o]);return z?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Team Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage employees and user accounts"})]})]}),e.jsxs(Q,{value:H,onValueChange:G,children:[e.jsxs(W,{className:"bg-muted/30 border border-border/50",children:[e.jsxs(L,{value:"employees",className:"data-[state=active]:bg-secondary gap-2",children:[e.jsx(u,{className:"h-4 w-4"}),"Employees"]}),e.jsxs(L,{value:"users",className:"data-[state=active]:bg-secondary gap-2",children:[e.jsx(u,{className:"h-4 w-4"}),"Users & Roles"]})]}),e.jsxs(P,{value:"employees",className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(m,{className:"bg-card/50 border-border/50",children:e.jsxs(h,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold",children:v.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]})}),e.jsx(m,{className:"bg-card/50 border-border/50",children:e.jsxs(h,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:v.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active"})]})}),e.jsx(m,{className:"bg-card/50 border-border/50",children:e.jsxs(h,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:v.plow}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Plow"})]})}),e.jsx(m,{className:"bg-card/50 border-border/50",children:e.jsxs(h,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-shovel",children:v.shovel}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Shovel"})]})})]}),e.jsxs(g,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Import"]}),e.jsx(m,{className:"bg-card/50 border-border/50",children:e.jsxs(h,{className:"pt-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search employees...",value:N,onChange:s=>q(s.target.value),className:"pl-9 bg-muted/30 border-border/50"})]}),e.jsxs(g,{onClick:()=>T(),className:"gap-2 bg-primary hover:bg-primary/90",children:[e.jsx(me,{className:"h-4 w-4"}),"Add Employee"]})]}),e.jsx("div",{className:"rounded-lg border border-border/50 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/30",children:e.jsxs("tr",{className:"text-left text-sm text-muted-foreground",children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Type"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-border/50",children:[w.map(s=>e.jsxs("tr",{className:"hover:bg-muted/20 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-muted/50 flex items-center justify-center",children:e.jsx(u,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("span",{className:"font-medium",children:[s.first_name," ",s.last_name]})]})}),e.jsxs("td",{className:"px-4 py-3",children:[s.category==="plow"&&e.jsxs(f,{className:"bg-primary/20 text-primary border-primary/30 gap-1",children:[e.jsx(R,{className:"h-3 w-3"}),"Plow"]}),s.category==="shovel"&&e.jsxs(f,{className:"bg-shovel/20 text-shovel border-shovel/30 gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),"Shovel"]}),s.category==="both"&&e.jsx("div",{className:"flex gap-1",children:e.jsxs(f,{className:"bg-primary/20 text-primary border-primary/30 gap-1",children:[e.jsx(R,{className:"h-3 w-3"}),"Plow"]})})]}),e.jsx("td",{className:"px-4 py-3",children:s.is_active?e.jsx(f,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Active"}):e.jsx(f,{variant:"outline",className:"text-muted-foreground",children:"Inactive"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs(re,{children:[e.jsx(te,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ne,{className:"h-4 w-4"})})}),e.jsxs(le,{align:"end",children:[e.jsxs(M,{onClick:()=>T(s),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(M,{onClick:()=>K(s.id),className:"text-destructive",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},s.id)),w.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-muted-foreground",children:"No employees found"})})]})]})}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-4",children:["Showing ",w.length," of ",o.length," results"]})]})})]}),e.jsx(P,{value:"users",className:"mt-6",children:e.jsx(m,{className:"bg-card/50 border-border/50",children:e.jsxs(h,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(u,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"User & Role management coming soon"})]})})})]}),e.jsx(X,{open:$,onOpenChange:y,children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:p?"Edit Employee":"Add Employee"}),e.jsx(se,{children:p?"Update employee information":"Create a new employee record"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"first_name",children:"First Name *"}),e.jsx(x,{id:"first_name",value:r.first_name,onChange:s=>n({...r,first_name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(x,{id:"last_name",value:r.last_name,onChange:s=>n({...r,last_name:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",children:"Email"}),e.jsx(x,{id:"email",type:"email",value:r.email,onChange:s=>n({...r,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"phone",children:"Phone"}),e.jsx(x,{id:"phone",value:r.phone,onChange:s=>n({...r,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Category"}),e.jsxs(I,{value:r.category,onValueChange:s=>n({...r,category:s}),children:[e.jsx(A,{children:e.jsx(U,{})}),e.jsx(k,{children:ue.map(s=>e.jsx(_,{value:s,children:e.jsx("span",{className:"capitalize",children:s})},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"hourly_rate",children:"Hourly Rate ($)"}),e.jsx(x,{id:"hourly_rate",type:"number",step:"0.01",value:r.hourly_rate,onChange:s=>n({...r,hourly_rate:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Link to User Account"}),e.jsxs(I,{value:r.user_id||"none",onValueChange:s=>n({...r,user_id:s==="none"?"":s}),children:[e.jsx(A,{children:e.jsx(U,{placeholder:"Select user account (optional)"})}),e.jsxs(k,{children:[e.jsx(_,{value:"none",children:"None"}),B.map(s=>e.jsx(_,{value:s.id,children:s.full_name||s.email||s.id},s.id))]})]})]})]}),e.jsxs(ae,{children:[e.jsx(g,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(g,{onClick:J,disabled:E,children:[E&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),p?"Update":"Create"]})]})]})})]})}export{De as default};
