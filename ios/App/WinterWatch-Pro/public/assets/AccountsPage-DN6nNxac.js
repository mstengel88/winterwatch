import{r as n,j as e,L as F,B as m,C as _,b as w,I as l,e as V,K as de,c as r,s as v,f as d}from"./index-BTTndiCa.js";import{T as he}from"./textarea-hKNpP3I7.js";import{S as me}from"./switch-D-37jlwR.js";import{B as u,S as I,a as E,b as P,c as B,d as f}from"./select-CkuTWz4P.js";import{D as U,a as $,b as R,c as W,d as q,e as G}from"./dialog-DzHIB3n4.js";import{d as xe,e as ue,f as pe,i as H}from"./index-C_FqIwIg.js";import{U as ge,E as je,a as ve,g as fe}from"./validations-xPfDVGkZ.js";import{S as ye}from"./search-CUdo4Vh7.js";import{P as Ne}from"./plus-DnkJBOXp.js";import{P as K}from"./pencil-VyY2SQ7L.js";import{T as Y}from"./trash-2-RpLMvkye.js";import{M as be}from"./map-pin-Dw0f1SUM.js";import"./Combination-BI3QGdrN.js";const _e=["plow","shovel","both"];function Le(){const[x,Z]=n.useState([]),[J,T]=n.useState(!0),[Q,S]=n.useState(!1),[y,L]=n.useState(null),[C,N]=n.useState(!1),[A,X]=n.useState(""),[c,j]=n.useState(new Set),[ee,k]=n.useState(!1),[o,z]=n.useState({service_type:"",priority:"",is_active:""}),[a,i]=n.useState({name:"",address:"",city:"",state:"WI",zip:"",contact_name:"",contact_phone:"",contact_email:"",latitude:"",longitude:"",geofence_radius:"100",priority:"5",service_type:"both",notes:"",is_active:!0}),b=async()=>{T(!0);try{const{data:s,error:t}=await v.from("accounts").select("*").order("priority").order("name");if(t)throw t;Z(s||[])}catch(s){console.error("Error fetching accounts:",s),d.error("Failed to load accounts")}finally{T(!1)}};n.useEffect(()=>{b()},[]);const M=s=>{var t,g,h,O;s?(L(s),i({name:s.name,address:s.address,city:s.city||"",state:s.state||"WI",zip:s.zip||"",contact_name:s.contact_name||"",contact_phone:s.contact_phone||"",contact_email:s.contact_email||"",latitude:((t=s.latitude)==null?void 0:t.toString())||"",longitude:((g=s.longitude)==null?void 0:g.toString())||"",geofence_radius:((h=s.geofence_radius)==null?void 0:h.toString())||"100",priority:((O=s.priority)==null?void 0:O.toString())||"5",service_type:s.service_type||"both",notes:s.notes||"",is_active:s.is_active})):(L(null),i({name:"",address:"",city:"",state:"WI",zip:"",contact_name:"",contact_phone:"",contact_email:"",latitude:"",longitude:"",geofence_radius:"100",priority:"5",service_type:"both",notes:"",is_active:!0})),S(!0)},se=async()=>{const s=ve.safeParse(a);if(!s.success){d.error(fe(s.error));return}N(!0);try{const t=s.data,g={name:t.name,address:t.address,city:t.city||null,state:t.state||null,zip:t.zip||null,contact_name:t.contact_name||null,contact_phone:t.contact_phone||null,contact_email:t.contact_email||null,latitude:t.latitude?parseFloat(t.latitude):null,longitude:t.longitude?parseFloat(t.longitude):null,geofence_radius:t.geofence_radius?parseInt(t.geofence_radius):100,priority:t.priority?parseInt(t.priority):5,service_type:a.service_type,notes:t.notes||null,is_active:t.is_active};if(y){const{error:h}=await v.from("accounts").update(g).eq("id",y.id);if(h)throw h;d.success("Account updated")}else{const{error:h}=await v.from("accounts").insert(g);if(h)throw h;d.success("Account created")}S(!1),b()}catch(t){console.error("Error saving account:",t),d.error("Failed to save account")}finally{N(!1)}},te=async s=>{if(confirm("Are you sure you want to delete this account?"))try{const{error:t}=await v.from("accounts").delete().eq("id",s);if(t)throw t;d.success("Account deleted"),b()}catch(t){console.error("Error deleting account:",t),d.error("Failed to delete account")}},ae=()=>{c.size===p.length?j(new Set):j(new Set(p.map(s=>s.id)))},re=s=>{const t=new Set(c);t.has(s)?t.delete(s):t.add(s),j(t)},ie=()=>{z({service_type:"",priority:"",is_active:""}),k(!0)},ce=async()=>{if(c.size!==0){N(!0);try{const s={};if(o.service_type&&(s.service_type=o.service_type),o.priority&&(s.priority=parseInt(o.priority)),o.is_active!==""&&(s.is_active=o.is_active==="true"),Object.keys(s).length===0){d.error("Please select at least one field to update"),N(!1);return}const{error:t}=await v.from("accounts").update(s).in("id",Array.from(c));if(t)throw t;d.success(`Updated ${c.size} accounts`),k(!1),j(new Set),b()}catch(s){console.error("Error bulk updating accounts:",s),d.error("Failed to update accounts")}finally{N(!1)}}},le=async()=>{if(c.size!==0&&confirm(`Are you sure you want to delete ${c.size} accounts?`))try{const{error:s}=await v.from("accounts").delete().in("id",Array.from(c));if(s)throw s;d.success(`Deleted ${c.size} accounts`),j(new Set),b()}catch(s){console.error("Error bulk deleting accounts:",s),d.error("Failed to delete accounts")}},p=n.useMemo(()=>{if(!A)return x;const s=A.toLowerCase();return x.filter(t=>t.name.toLowerCase().includes(s)||t.address.toLowerCase().includes(s))},[x,A]),D=n.useMemo(()=>{const s=x.filter(h=>h.is_active).length,t=x.length,g=Math.floor(x.length*.5);return{total:x.length,active:s,plow:t,shovel:g}},[x]),ne=s=>s?s<=3?e.jsx(u,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"high"}):s<=6?e.jsx(u,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"medium"}):e.jsx(u,{variant:"outline",children:"low"}):e.jsx(u,{variant:"outline",children:"medium"}),oe=s=>{const t=s.service_type||"both";return t==="plow"?e.jsx(u,{className:"bg-primary/20 text-primary border-primary/30",children:"Plow"}):t==="shovel"?e.jsx(u,{className:"bg-shovel/20 text-shovel border-shovel/30",children:"Shovel"}):e.jsx(u,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Both"})};return J?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Accounts"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer accounts and service locations"})]}),e.jsxs(m,{variant:"outline",className:"gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Import CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(_,{className:"bg-card/50 border-border/50",children:e.jsxs(w,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold",children:D.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Accounts"})]})}),e.jsx(_,{className:"bg-card/50 border-border/50",children:e.jsxs(w,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:D.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active"})]})}),e.jsx(_,{className:"bg-card/50 border-border/50",children:e.jsxs(w,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:D.plow}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Plow Service"})]})}),e.jsx(_,{className:"bg-card/50 border-border/50",children:e.jsxs(w,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-shovel",children:D.shovel}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Shovel Service"})]})})]}),e.jsx(_,{className:"bg-card/50 border-border/50",children:e.jsxs(w,{className:"pt-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(l,{placeholder:"Search accounts...",value:A,onChange:s=>X(s.target.value),className:"pl-9 bg-muted/30 border-border/50"})]}),e.jsxs(m,{onClick:()=>M(),className:"gap-2 bg-primary hover:bg-primary/90",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Add Account"]})]}),c.size>0&&e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-3 bg-primary/10 border border-primary/30 rounded-lg",children:[e.jsxs("span",{className:"text-sm font-medium",children:[c.size," selected"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(m,{size:"sm",variant:"outline",onClick:ie,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Bulk Edit"]}),e.jsxs(m,{size:"sm",variant:"outline",className:"text-destructive border-destructive/50 hover:bg-destructive/10",onClick:le,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Delete Selected"]}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>j(new Set),children:"Clear"})]}),e.jsx("div",{className:"rounded-lg border border-border/50 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/30",children:e.jsxs("tr",{className:"text-left text-sm text-muted-foreground",children:[e.jsx("th",{className:"px-4 py-3 font-medium w-10",children:e.jsx(V,{checked:c.size===p.length&&p.length>0,onCheckedChange:ae})}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Address"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Contact"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Service"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Priority"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-border/50",children:[p.map(s=>e.jsxs("tr",{className:`hover:bg-muted/20 transition-colors ${c.has(s.id)?"bg-primary/5":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(V,{checked:c.has(s.id),onCheckedChange:()=>re(s.id)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(be,{className:"h-3 w-3 shrink-0"}),e.jsxs("span",{className:"truncate max-w-[200px]",children:[s.address,s.city?`, ${s.city}`:"",s.state?`, ${s.state}`:""," ",s.zip||""]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.contact_name||"-"}),e.jsx("td",{className:"px-4 py-3",children:oe(s)}),e.jsx("td",{className:"px-4 py-3",children:ne(s.priority)}),e.jsx("td",{className:"px-4 py-3",children:s.is_active?e.jsx(u,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Active"}):e.jsx(u,{variant:"outline",className:"text-muted-foreground",children:"Inactive"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs(xe,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(pe,{align:"end",children:[e.jsxs(H,{onClick:()=>M(s),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(H,{onClick:()=>te(s.id),className:"text-destructive",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},s.id)),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-muted-foreground",children:"No accounts found"})})]})]})}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-4",children:["Showing ",p.length," of ",x.length," results"]})]})}),e.jsx(U,{open:Q,onOpenChange:S,children:e.jsxs($,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(W,{children:y?"Edit Account":"Add Account"}),e.jsx(q,{children:y?"Update service location":"Add a new service location"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"name",children:"Account Name *"}),e.jsx(l,{id:"name",value:a.name,onChange:s=>i({...a,name:s.target.value}),placeholder:"e.g., Main Street Plaza"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"address",children:"Address *"}),e.jsx(l,{id:"address",value:a.address,onChange:s=>i({...a,address:s.target.value}),placeholder:"123 Main St"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"city",children:"City"}),e.jsx(l,{id:"city",value:a.city,onChange:s=>i({...a,city:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"state",children:"State"}),e.jsx(l,{id:"state",value:a.state,onChange:s=>i({...a,state:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"zip",children:"ZIP"}),e.jsx(l,{id:"zip",value:a.zip,onChange:s=>i({...a,zip:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"contact_name",children:"Contact Name"}),e.jsx(l,{id:"contact_name",value:a.contact_name,onChange:s=>i({...a,contact_name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"contact_phone",children:"Contact Phone"}),e.jsx(l,{id:"contact_phone",value:a.contact_phone,onChange:s=>i({...a,contact_phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"contact_email",children:"Contact Email"}),e.jsx(l,{id:"contact_email",type:"email",value:a.contact_email,onChange:s=>i({...a,contact_email:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"latitude",children:"Latitude"}),e.jsx(l,{id:"latitude",type:"number",step:"any",value:a.latitude,onChange:s=>i({...a,latitude:s.target.value}),placeholder:"42.3314"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"longitude",children:"Longitude"}),e.jsx(l,{id:"longitude",type:"number",step:"any",value:a.longitude,onChange:s=>i({...a,longitude:s.target.value}),placeholder:"-83.0458"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"geofence_radius",children:"Geofence (meters)"}),e.jsx(l,{id:"geofence_radius",type:"number",value:a.geofence_radius,onChange:s=>i({...a,geofence_radius:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"priority",children:"Priority (1-10, lower = higher)"}),e.jsx(l,{id:"priority",type:"number",min:"1",max:"10",value:a.priority,onChange:s=>i({...a,priority:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Service Type"}),e.jsxs(I,{value:a.service_type,onValueChange:s=>i({...a,service_type:s}),children:[e.jsx(E,{className:"bg-card",children:e.jsx(P,{})}),e.jsx(B,{className:"bg-card",children:_e.map(s=>e.jsx(f,{value:s,children:e.jsx("span",{className:"capitalize",children:s})},s))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(me,{id:"is_active",checked:a.is_active,onCheckedChange:s=>i({...a,is_active:s})}),e.jsx(r,{htmlFor:"is_active",children:"Active Account"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"notes",children:"Notes"}),e.jsx(he,{id:"notes",value:a.notes,onChange:s=>i({...a,notes:s.target.value}),placeholder:"Special instructions, access codes, etc."})]})]}),e.jsxs(G,{children:[e.jsx(m,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsxs(m,{onClick:se,disabled:C,children:[C&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),y?"Update":"Create"]})]})]})}),e.jsx(U,{open:ee,onOpenChange:k,children:e.jsxs($,{children:[e.jsxs(R,{children:[e.jsxs(W,{children:["Bulk Edit ",c.size," Accounts"]}),e.jsx(q,{children:"Only fields you change will be updated. Leave fields empty to keep existing values."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Service Type"}),e.jsxs(I,{value:o.service_type,onValueChange:s=>z({...o,service_type:s}),children:[e.jsx(E,{className:"bg-card",children:e.jsx(P,{placeholder:"No change"})}),e.jsxs(B,{className:"bg-card",children:[e.jsx(f,{value:"plow",children:"Plow"}),e.jsx(f,{value:"shovel",children:"Shovel"}),e.jsx(f,{value:"both",children:"Both"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Priority (1-10)"}),e.jsx(l,{type:"number",min:"1",max:"10",value:o.priority,onChange:s=>z({...o,priority:s.target.value}),placeholder:"No change"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Status"}),e.jsxs(I,{value:o.is_active,onValueChange:s=>z({...o,is_active:s}),children:[e.jsx(E,{className:"bg-card",children:e.jsx(P,{placeholder:"No change"})}),e.jsxs(B,{className:"bg-card",children:[e.jsx(f,{value:"true",children:"Active"}),e.jsx(f,{value:"false",children:"Inactive"})]})]})]})]}),e.jsxs(G,{children:[e.jsx(m,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsxs(m,{onClick:ce,disabled:C,children:[C&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),"Update ",c.size," Accounts"]})]})]})})]})}export{Le as default};
