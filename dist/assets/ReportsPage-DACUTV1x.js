import{c as Ce,a0 as vs,r as l,j as e,o as w,S as R,p as z,q as H,t as W,v as b,I,k as g,L as ke,z as Ct,aB as ws,aC as At,aD as Tt,ae as gs,aE as Mt,ac as Et,aF as Lt,ag as $t,aG as Ot,aH as It,aI as Pt,aJ as bs,aK as qt,aL as Rt,a5 as oe,aM as ks,s as k,w as v,aq as zt,ar as Ht,aN as Wt,as as Ft,at as Fe,i as ms,a3 as Ut,C as ie,g as ce,ao as hs,y as ge,aO as Vt,H as Bt,J as Gt,K as us,O as ps,B as Oe,aP as Jt,V as D,Z as Ne}from"./index-CnGaZqSN.js";import{T as Ue,a as Ve,b as Z,c as u,d as Be,e as h}from"./table-Cg0xew9Q.js";import{D as Je,a as Ye,b as Ke,c as Ze,e as Ss}from"./dialog-Hlo-k202.js";import{F as xs,a as Yt,g as Kt}from"./pdfExport-Pv2pQLSC.js";import{T as De}from"./trash-2-CZ7AlvHE.js";import{P as Ge}from"./pencil-BlT1alPn.js";const _s=Ce("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);const Zt=Ce("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);const js=Ce("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const Ie=Ce("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);const Qt=Ce("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);function Xt(n){const i=vs(n),o=i.getMonth();return i.setFullYear(i.getFullYear(),o+1,0),i.setHours(23,59,59,999),i}function ea(n){const i=vs(n);return i.setDate(1),i.setHours(0,0,0,0),i}function sa({open:n,onOpenChange:i,employees:o,initialData:p,onSave:x,isLoading:_=!1}){const[S,T]=l.useState(""),[N,C]=l.useState(""),[L,F]=l.useState(""),[$,G]=l.useState("");l.useEffect(()=>{if(p){T(p.employee_id);const y=new Date(p.clock_in_time);if(C(y.toISOString().split("T")[0]),F(y.toTimeString().slice(0,5)),p.clock_out_time){const Y=new Date(p.clock_out_time);G(Y.toTimeString().slice(0,5))}else G("")}else T(""),C(new Date().toISOString().split("T")[0]),F(""),G("")},[p,n]);const P=async y=>{y.preventDefault(),await x({id:p?.id,employee_id:S,clock_in_date:N,clock_in_time:L,clock_out_time:$})},X=!!p;return e.jsx(Je,{open:n,onOpenChange:i,children:e.jsxs(Ye,{className:"sm:max-w-[425px]",children:[e.jsx(Ke,{children:e.jsx(Ze,{children:X?"Edit Shift":"Add New Shift"})}),e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Employee"}),e.jsxs(R,{value:S,onValueChange:T,required:!0,children:[e.jsx(z,{children:e.jsx(H,{placeholder:"Select employee"})}),e.jsx(W,{children:o.filter(y=>y.id&&y.id.trim()!=="").map(y=>e.jsxs(b,{value:y.id,children:[y.first_name," ",y.last_name]},y.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Date"}),e.jsx(I,{type:"date",value:N,onChange:y=>C(y.target.value),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Clock In Time"}),e.jsx(I,{type:"time",value:L,onChange:y=>F(y.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Clock Out Time"}),e.jsx(I,{type:"time",value:$,onChange:y=>G(y.target.value)})]})]})]}),e.jsxs(Ss,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(g,{type:"submit",disabled:_||!S||!N||!L,children:[_&&e.jsx(ke,{className:"h-4 w-4 mr-2 animate-spin"}),X?"Update":"Create"]})]})]})]})})}function ta({open:n,onOpenChange:i,accounts:o,employees:p,equipment:x,initialData:_,onSave:S,isLoading:T=!1}){const[N,C]=l.useState("plow"),[L,F]=l.useState(""),[$,G]=l.useState(""),[P,X]=l.useState(""),[y,Y]=l.useState("plow"),[de,xe]=l.useState(""),[me,_e]=l.useState(""),[J,je]=l.useState(""),[ee,fe]=l.useState(""),[se,ye]=l.useState(""),[te,ve]=l.useState(""),[he,we]=l.useState(""),[ae,Se]=l.useState("");l.useEffect(()=>{if(_){if(C(_.type),F(_.account_id),G(_.employee_id||""),X(_.equipment_id||""),Y(_.service_type),_.check_in_time){const r=new Date(_.check_in_time);xe(r.toISOString().split("T")[0]),_e(r.toTimeString().slice(0,5))}if(_.check_out_time){const r=new Date(_.check_out_time);je(r.toTimeString().slice(0,5))}fe(_.snow_depth_inches?.toString()||""),ye(_.salt_used_lbs?.toString()||""),ve(_.ice_melt_used_lbs?.toString()||""),we(_.weather_conditions||""),Se(_.notes||"")}else C("plow"),F(""),G(""),X(""),Y("plow"),xe(new Date().toISOString().split("T")[0]),_e(""),je(""),fe(""),ye(""),ve(""),we(""),Se("")},[_,n]);const U=async r=>{r.preventDefault(),await S({id:_?.id,type:N,account_id:L,employee_id:$,equipment_id:P||void 0,service_type:y,date:de,check_in_time:me,check_out_time:J,snow_depth_inches:ee?parseFloat(ee):void 0,salt_used_lbs:se?parseFloat(se):void 0,ice_melt_used_lbs:te?parseFloat(te):void 0,weather_conditions:he||void 0,notes:ae||void 0})},le=!!_,M=N==="plow"?[{value:"plow",label:"Plow"},{value:"salt",label:"Salt"},{value:"both",label:"Plow/Salt"}]:[{value:"shovel",label:"Shovel Walks"},{value:"ice_melt",label:"Salt Walks"},{value:"both",label:"Shovel/Salt Walks"}];return e.jsx(Je,{open:n,onOpenChange:i,children:e.jsxs(Ye,{className:"sm:max-w-[550px] max-h-[90vh] overflow-y-auto",children:[e.jsx(Ke,{children:e.jsx(Ze,{children:le?"Edit Work Log":"Add New Work Log"})}),e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Log Type"}),e.jsxs(R,{value:N,onValueChange:r=>{C(r),Y(r==="plow"?"plow":"shovel")},disabled:le,children:[e.jsx(z,{children:e.jsx(H,{})}),e.jsxs(W,{children:[e.jsx(b,{value:"plow",children:"Plow (Driver)"}),e.jsx(b,{value:"shovel",children:"Shovel (Crew)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Account/Location"}),e.jsxs(R,{value:L,onValueChange:F,required:!0,children:[e.jsx(z,{children:e.jsx(H,{placeholder:"Select account"})}),e.jsx(W,{children:o.filter(r=>r.id&&r.id.trim()!=="").map(r=>e.jsx(b,{value:r.id,children:r.name},r.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Employee"}),e.jsxs(R,{value:$,onValueChange:G,required:!0,children:[e.jsx(z,{children:e.jsx(H,{placeholder:"Select employee"})}),e.jsx(W,{children:p.filter(r=>r.id&&r.id.trim()!=="").map(r=>e.jsxs(b,{value:r.id,children:[r.first_name," ",r.last_name]},r.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Service Type"}),e.jsxs(R,{value:y,onValueChange:Y,children:[e.jsx(z,{children:e.jsx(H,{})}),e.jsx(W,{children:M.map(r=>e.jsx(b,{value:r.value,children:r.label},r.value))})]})]}),N==="plow"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Equipment"}),e.jsxs(R,{value:P,onValueChange:r=>X(r==="none"?"":r),children:[e.jsx(z,{children:e.jsx(H,{placeholder:"Select equipment"})}),e.jsxs(W,{children:[e.jsx(b,{value:"none",children:"None"}),x.filter(r=>r.id&&r.id.trim()!=="").map(r=>e.jsx(b,{value:r.id,children:r.name},r.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Date"}),e.jsx(I,{type:"date",value:de,onChange:r=>xe(r.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Check In"}),e.jsx(I,{type:"time",value:me,onChange:r=>_e(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Check Out"}),e.jsx(I,{type:"time",value:J,onChange:r=>je(r.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Snow Depth (inches)"}),e.jsx(I,{type:"number",step:"0.1",placeholder:"e.g., 3.5",value:ee,onChange:r=>fe(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:N==="plow"?"Salt Used (lbs)":"Ice Melt (lbs)"}),e.jsx(I,{type:"number",step:"1",placeholder:"e.g., 50",value:N==="plow"?se:te,onChange:r=>N==="plow"?ye(r.target.value):ve(r.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Weather Conditions"}),e.jsx(I,{placeholder:"e.g., Light snow, 28Â°F",value:he,onChange:r=>we(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Notes"}),e.jsx(Ct,{placeholder:"Additional notes...",value:ae,onChange:r=>Se(r.target.value),rows:2})]})]}),e.jsxs(Ss,{children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(g,{type:"submit",disabled:T||!L||!$,children:[T&&e.jsx(ke,{className:"h-4 w-4 mr-2 animate-spin"}),le?"Update":"Create"]})]})]})]})})}var Ns="AlertDialog",[aa]=Et(Ns,[ws]),Q=ws(),Ds=n=>{const{__scopeAlertDialog:i,...o}=n,p=Q(i);return e.jsx(At,{...p,...o,modal:!0})};Ds.displayName=Ns;var la="AlertDialogTrigger",na=l.forwardRef((n,i)=>{const{__scopeAlertDialog:o,...p}=n,x=Q(o);return e.jsx(Rt,{...x,...p,ref:i})});na.displayName=la;var ra="AlertDialogPortal",Cs=n=>{const{__scopeAlertDialog:i,...o}=n,p=Q(i);return e.jsx(Tt,{...p,...o})};Cs.displayName=ra;var ia="AlertDialogOverlay",As=l.forwardRef((n,i)=>{const{__scopeAlertDialog:o,...p}=n,x=Q(o);return e.jsx(qt,{...x,...p,ref:i})});As.displayName=ia;var be="AlertDialogContent",[ca,oa]=aa(be),da=Ot("AlertDialogContent"),Ts=l.forwardRef((n,i)=>{const{__scopeAlertDialog:o,children:p,...x}=n,_=Q(o),S=l.useRef(null),T=gs(i,S),N=l.useRef(null);return e.jsx(Mt,{contentName:be,titleName:Ms,docsSlug:"alert-dialog",children:e.jsx(ca,{scope:o,cancelRef:N,children:e.jsxs(Lt,{role:"alertdialog",..._,...x,ref:T,onOpenAutoFocus:$t(x.onOpenAutoFocus,C=>{C.preventDefault(),N.current?.focus({preventScroll:!0})}),onPointerDownOutside:C=>C.preventDefault(),onInteractOutside:C=>C.preventDefault(),children:[e.jsx(da,{children:p}),e.jsx(ha,{contentRef:S})]})})})});Ts.displayName=be;var Ms="AlertDialogTitle",Es=l.forwardRef((n,i)=>{const{__scopeAlertDialog:o,...p}=n,x=Q(o);return e.jsx(It,{...x,...p,ref:i})});Es.displayName=Ms;var Ls="AlertDialogDescription",$s=l.forwardRef((n,i)=>{const{__scopeAlertDialog:o,...p}=n,x=Q(o);return e.jsx(Pt,{...x,...p,ref:i})});$s.displayName=Ls;var ma="AlertDialogAction",Os=l.forwardRef((n,i)=>{const{__scopeAlertDialog:o,...p}=n,x=Q(o);return e.jsx(bs,{...x,...p,ref:i})});Os.displayName=ma;var Is="AlertDialogCancel",Ps=l.forwardRef((n,i)=>{const{__scopeAlertDialog:o,...p}=n,{cancelRef:x}=oa(Is,o),_=Q(o),S=gs(i,x);return e.jsx(bs,{..._,...p,ref:S})});Ps.displayName=Is;var ha=({contentRef:n})=>{const i=`\`${be}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${be}\` by passing a \`${Ls}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${be}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{document.getElementById(n.current?.getAttribute("aria-describedby"))||console.warn(i)},[i,n]),null},ua=Ds,pa=Cs,qs=As,Rs=Ts,zs=Os,Hs=Ps,Ws=Es,Fs=$s;const xa=ua,_a=pa,Us=l.forwardRef(({className:n,...i},o)=>e.jsx(qs,{className:oe("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...i,ref:o}));Us.displayName=qs.displayName;const Vs=l.forwardRef(({className:n,...i},o)=>e.jsxs(_a,{children:[e.jsx(Us,{}),e.jsx(Rs,{ref:o,className:oe("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...i})]}));Vs.displayName=Rs.displayName;const Bs=({className:n,...i})=>e.jsx("div",{className:oe("flex flex-col space-y-2 text-center sm:text-left",n),...i});Bs.displayName="AlertDialogHeader";const Gs=({className:n,...i})=>e.jsx("div",{className:oe("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",n),...i});Gs.displayName="AlertDialogFooter";const Js=l.forwardRef(({className:n,...i},o)=>e.jsx(Ws,{ref:o,className:oe("text-lg font-semibold",n),...i}));Js.displayName=Ws.displayName;const Ys=l.forwardRef(({className:n,...i},o)=>e.jsx(Fs,{ref:o,className:oe("text-sm text-muted-foreground",n),...i}));Ys.displayName=Fs.displayName;const Ks=l.forwardRef(({className:n,...i},o)=>e.jsx(zs,{ref:o,className:oe(ks(),n),...i}));Ks.displayName=zs.displayName;const Zs=l.forwardRef(({className:n,...i},o)=>e.jsx(Hs,{ref:o,className:oe(ks({variant:"outline"}),"mt-2 sm:mt-0",n),...i}));Zs.displayName=Hs.displayName;function fs({open:n,onOpenChange:i,title:o,description:p,onConfirm:x,isLoading:_=!1}){const S=async()=>{await x()};return e.jsx(xa,{open:n,onOpenChange:i,children:e.jsxs(Vs,{children:[e.jsxs(Bs,{children:[e.jsx(Js,{children:o}),e.jsx(Ys,{children:p})]}),e.jsxs(Gs,{children:[e.jsx(Zs,{disabled:_,children:"Cancel"}),e.jsxs(Ks,{onClick:S,disabled:_,className:"bg-red-600 hover:bg-red-700",children:[_&&e.jsx(ke,{className:"h-4 w-4 mr-2 animate-spin"}),"Delete"]})]})]})})}function ys({photoPaths:n,onViewPhotos:i}){const[o,p]=l.useState([]),[x,_]=l.useState(!0);return l.useEffect(()=>{(async()=>{if(!n||n.length===0){_(!1);return}const T=[],N=n.slice(0,3);for(const C of N){if(C.startsWith("http")){T.push(C);continue}const{data:L,error:F}=await k.storage.from("work-photos").createSignedUrl(C,3600);!F&&L?.signedUrl&&T.push(L.signedUrl)}p(T),_(!1)})()},[n]),!n||n.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):x?e.jsx(ke,{className:"h-4 w-4 animate-spin text-muted-foreground"}):e.jsxs("div",{className:"flex items-center gap-1",children:[o.map((S,T)=>e.jsx("button",{onClick:()=>i(n),className:"h-8 w-8 rounded overflow-hidden border border-border/50 hover:ring-2 ring-primary transition-all flex-shrink-0",children:e.jsx("img",{src:S,alt:`Photo ${T+1}`,className:"h-full w-full object-cover",loading:"lazy"})},T)),n.length>3&&e.jsxs("button",{onClick:()=>i(n),className:"h-8 w-8 rounded bg-muted flex items-center justify-center text-xs font-medium text-muted-foreground hover:bg-muted/80 flex-shrink-0",children:["+",n.length-3]})]})}function ba(){const[n,i]=l.useState(!0),[o,p]=l.useState([]),[x,_]=l.useState([]),[S,T]=l.useState([]),[N,C]=l.useState([]),[L,F]=l.useState([]),[$,G]=l.useState(()=>v(ea(new Date),"yyyy-MM-dd")),[P,X]=l.useState(()=>v(Xt(new Date),"yyyy-MM-dd")),[y,Y]=l.useState("all"),[de,xe]=l.useState("all"),[me,_e]=l.useState("all"),[J,je]=l.useState("all"),[ee,fe]=l.useState("all"),[se,ye]=l.useState("all"),[te,ve]=l.useState(""),[he,we]=l.useState(""),[ae,Se]=l.useState("current"),[U,le]=l.useState(new Set),[M,r]=l.useState(new Set),[Qs,Ae]=l.useState(!1),[Xs,Te]=l.useState(!1),[et,Me]=l.useState(!1),[st,Ee]=l.useState(!1),[Le,Qe]=l.useState("shifts"),[tt,Pe]=l.useState(null),[O,qe]=l.useState(null),[ne,Re]=l.useState(null),[K,q]=l.useState(!1),[at,Xe]=l.useState(!1),[ue,lt]=l.useState([]),[ze,He]=l.useState(0),[es,ss]=l.useState(!1),nt=async s=>{if(s.length===0)return[];const a=[];for(const c of s){if(c.startsWith("http")){a.push(c);continue}const{data:d,error:t}=await k.storage.from("work-photos").createSignedUrl(c,3600);!t&&d?.signedUrl&&a.push(d.signedUrl)}return a},ts=async s=>{if(!s||s.length===0)return;ss(!0),Xe(!0),He(0);const a=await nt(s);lt(a),ss(!1)},rt=()=>{He(s=>(s+1)%ue.length)},it=()=>{He(s=>(s-1+ue.length)%ue.length)},re=async()=>{i(!0);try{const s=new Date($);s.setHours(0,0,0,0);const a=new Date(P);a.setHours(23,59,59,999);const[c,d,t,j,pe,A]=await Promise.all([k.from("time_clock").select("*, employee:employees(first_name, last_name)").gte("clock_in_time",s.toISOString()).lte("clock_in_time",a.toISOString()).order("clock_in_time",{ascending:!1}),k.from("work_logs").select("*, account:accounts(name), employee:employees(first_name, last_name), equipment:equipment(name)").gte("created_at",s.toISOString()).lte("created_at",a.toISOString()).order("created_at",{ascending:!1}),k.from("shovel_work_logs").select("*, account:accounts(name), employee:employees(first_name, last_name)").gte("created_at",s.toISOString()).lte("created_at",a.toISOString()).order("created_at",{ascending:!1}),k.from("accounts").select("id, name").eq("is_active",!0).order("name"),k.from("employees").select("id, first_name, last_name, category").eq("is_active",!0).order("first_name"),k.from("equipment").select("id, name").eq("is_active",!0).eq("status","available").order("name")]);p(c.data||[]),T(j.data||[]),C(pe.data||[]),F(A.data||[]);const E=(d.data||[]).map(m=>({id:m.id,type:"plow",date:m.created_at,check_in_time:m.check_in_time,check_out_time:m.check_out_time,account_id:m.account_id,account_name:m.account?.name||"Unknown",employee_id:m.employee_id||"",service_type:m.service_type,snow_depth_inches:m.snow_depth_inches,salt_used_lbs:m.salt_used_lbs,ice_melt_used_lbs:null,weather_conditions:m.weather_conditions,equipment_id:m.equipment_id,equipment_name:m.equipment?.name||null,employee_name:m.employee?`${m.employee.first_name} ${m.employee.last_name}`:"Unknown",team_member_names:[],photo_urls:m.photo_urls,notes:m.notes,billed:m.billed||!1})),St=t.data||[],Nt=await Promise.all(St.map(async m=>{let $e=[];if(m.team_member_ids&&m.team_member_ids.length>0){const{data:Dt}=await k.from("employees").select("first_name, last_name").in("id",m.team_member_ids);$e=(Dt||[]).map(ds=>`${ds.first_name} ${ds.last_name}`)}return{id:m.id,type:"shovel",date:m.created_at,check_in_time:m.check_in_time,check_out_time:m.check_out_time,account_id:m.account_id,account_name:m.account?.name||"Unknown",employee_id:m.employee_id||"",service_type:m.service_type,snow_depth_inches:m.snow_depth_inches,salt_used_lbs:null,ice_melt_used_lbs:m.ice_melt_used_lbs,weather_conditions:m.weather_conditions,equipment_id:null,equipment_name:null,employee_name:m.employee?`${m.employee.first_name} ${m.employee.last_name}`:"Unknown",team_member_names:$e,photo_urls:m.photo_urls,notes:m.notes,billed:m.billed||!1}}));_([...E,...Nt].sort((m,$e)=>new Date($e.date).getTime()-new Date(m.date).getTime()))}catch(s){console.error("Error fetching report data:",s),D.error("Failed to load report data")}finally{i(!1)}};l.useEffect(()=>{re()},[$,P]);const V=l.useMemo(()=>o.filter(s=>!(J!=="all"&&s.employee_id!==J)),[o,J]),f=l.useMemo(()=>x.filter(s=>{if(ae==="current"&&s.billed||ae==="archived"&&!s.billed||y!=="all"&&s.type!==y||ee!=="all"&&s.service_type!==ee)return!1;if(s.type==="plow"&&de!=="all"){const a=S.find(c=>c.id===de);if(a&&s.account_name!==a.name)return!1}if(s.type==="shovel"&&me!=="all"){const a=S.find(c=>c.id===me);if(a&&s.account_name!==a.name)return!1}if(J!=="all"){const a=N.find(c=>c.id===J);if(a&&s.employee_name!==`${a.first_name} ${a.last_name}`)return!1}if(se!=="all"&&s.type==="plow"){const a=L.find(c=>c.id===se);if(a&&s.equipment_name!==a.name)return!1}if(te&&s.snow_depth_inches!==null&&s.snow_depth_inches<parseFloat(te))return!1;if(he){const a=s.type==="plow"?s.salt_used_lbs:s.ice_melt_used_lbs;if(a!==null&&a<parseFloat(he))return!1}return!0}),[x,y,de,me,J,ee,se,te,he,S,N,L,ae]),ct=l.useMemo(()=>x.filter(s=>!s.billed).length,[x]),ot=l.useMemo(()=>x.filter(s=>s.billed).length,[x]),B=l.useMemo(()=>{const s=f.filter(t=>t.type==="plow").length,a=f.filter(t=>t.type==="shovel").length,c=f.filter(t=>t.service_type==="salt"||t.service_type==="both"||t.service_type==="ice_melt").length,d=new Set(f.map(t=>t.account_name)).size;return{total:f.length,plow:s,shovel:a,salt:c,locations:d}},[f]),dt=()=>{Y("all"),xe("all"),_e("all"),je("all"),fe("all"),ye("all"),ve(""),we("")},We=(s,a)=>{if(!s||!a)return"-";const c=Ne(new Date(a),new Date(s)),d=Math.floor(c/60),t=c%60;return`${d}h ${t}m`},as=(s,a)=>!s||!a?"-":`${(Ne(new Date(a),new Date(s))/60).toFixed(1)}h`,mt=()=>{ls(),setTimeout(()=>{window.print()},500)},ls=()=>{const s=f.map(t=>{const j=t.type==="shovel"&&t.team_member_names&&t.team_member_names.length>0?t.team_member_names.join(", "):t.employee_name;return{id:t.id,type:t.type,date:v(new Date(t.date),"MM/dd/yy"),checkIn:t.check_in_time?v(new Date(t.check_in_time),"HH:mm"):"-",checkOut:t.check_out_time?v(new Date(t.check_out_time),"HH:mm"):"-",duration:We(t.check_in_time,t.check_out_time),account:t.account_name,serviceType:t.service_type,snowDepth:t.snow_depth_inches?`${t.snow_depth_inches}"`:"-",saltLbs:t.salt_used_lbs?`${t.salt_used_lbs}lb`:t.ice_melt_used_lbs?`${t.ice_melt_used_lbs}lb`:"-",equipment:t.equipment_name||"-",employee:j,conditions:t.weather_conditions||"-",notes:t.notes||void 0}});f.reduce((t,j)=>j.check_in_time&&j.check_out_time?t+Ne(new Date(j.check_out_time),new Date(j.check_in_time))/60:t,0);const a=new Set(f.map(t=>t.account_name)).size,c=f.filter(t=>t.service_type==="plow"||t.service_type==="both").length,d=f.filter(t=>t.service_type==="salt"||t.service_type==="ice_melt"||t.service_type==="both").length;Kt(s,{totalJobs:B.total,totalSaltLbs:f.reduce((t,j)=>t+(j.salt_used_lbs||0),0),totalIceMeltLbs:f.reduce((t,j)=>t+(j.ice_melt_used_lbs||0),0),plowCount:c,saltCount:d,propertyCount:a,dateRange:`${v(new Date($),"yyyy-MM-dd")} to ${v(new Date(P),"yyyy-MM-dd")}`}),D.success("PDF exported successfully")},ht=()=>{const s=["Employee","Date","Clock In","Clock Out","Hours Worked","Location"],a=V.map(j=>{const pe=j.employee?`${j.employee.first_name} ${j.employee.last_name}`:"Unknown",A=as(j.clock_in_time,j.clock_out_time),E=j.clock_in_latitude&&j.clock_in_longitude?`${j.clock_in_latitude.toFixed(4)}, ${j.clock_in_longitude.toFixed(4)}`:"-";return[pe,v(new Date(j.clock_in_time),"MM/dd/yyyy"),v(new Date(j.clock_in_time),"HH:mm"),j.clock_out_time?v(new Date(j.clock_out_time),"HH:mm"):"-",A,E]}),c=[s,...a].map(j=>j.join(",")).join(`
`),d=new Blob([c],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(d),t.download=`timesheets_${v(new Date($),"yyyy-MM-dd")}_to_${v(new Date(P),"yyyy-MM-dd")}.csv`,t.click(),D.success("Time sheets exported successfully")},ut=()=>{const s=V.reduce((A,E)=>E.clock_in_time&&E.clock_out_time?A+Ne(new Date(E.clock_out_time),new Date(E.clock_in_time))/60:A,0),a=f.reduce((A,E)=>E.check_in_time&&E.check_out_time?A+Ne(new Date(E.check_out_time),new Date(E.check_in_time))/60:A,0),c=new Set([...V.map(A=>A.employee_id),...f.map(A=>A.employee_id)].filter(Boolean)).size,t=[["WinterWatch-Pro Summary Report"],[`Period: ${v(new Date($),"MM/dd/yyyy")} to ${v(new Date(P),"MM/dd/yyyy")}`],[`Generated: ${v(new Date,"MM/dd/yyyy HH:mm")}`],[""],["TIME CLOCK SUMMARY"],["Total Shifts",V.length.toString()],["Total Hours",s.toFixed(1)],[""],["WORK LOG SUMMARY"],["Total Jobs",B.total.toString()],["Plow Jobs",B.plow.toString()],["Shovel Jobs",B.shovel.toString()],["Salt Applications",B.salt.toString()],["Total Work Hours",a.toFixed(1)],["Unique Locations",B.locations.toString()],[""],["OVERALL"],["Active Employees",c.toString()],["Total Salt Used (lbs)",f.reduce((A,E)=>A+(E.salt_used_lbs||0),0).toString()],["Total Ice Melt Used (lbs)",f.reduce((A,E)=>A+(E.ice_melt_used_lbs||0),0).toString()]].map(A=>A.join(",")).join(`
`),j=new Blob([t],{type:"text/csv;charset=utf-8;"}),pe=document.createElement("a");pe.href=URL.createObjectURL(j),pe.download=`summary_${v(new Date($),"yyyy-MM-dd")}_to_${v(new Date(P),"yyyy-MM-dd")}.csv`,pe.click(),D.success("Summary report exported successfully")},pt=()=>{U.size===V.length?le(new Set):le(new Set(V.map(s=>s.id)))},ns=()=>{M.size===f.length?r(new Set):r(new Set(f.map(s=>s.id)))},xt=async s=>{q(!0);try{const a=new Date(`${s.clock_in_date}T${s.clock_in_time}`),c=s.clock_out_time?new Date(`${s.clock_in_date}T${s.clock_out_time}`):null;if(s.id){const{error:d}=await k.from("time_clock").update({employee_id:s.employee_id,clock_in_time:a.toISOString(),clock_out_time:c?.toISOString()||null}).eq("id",s.id);if(d)throw d;D.success("Shift updated successfully")}else{const{error:d}=await k.from("time_clock").insert({employee_id:s.employee_id,clock_in_time:a.toISOString(),clock_out_time:c?.toISOString()||null});if(d)throw d;D.success("Shift created successfully")}Ae(!1),Pe(null),await re()}catch(a){console.error("Error saving shift:",a),D.error("Failed to save shift")}finally{q(!1)}},_t=async s=>{q(!0);try{const a=s.check_in_time?new Date(`${s.date}T${s.check_in_time}`):null,c=s.check_out_time?new Date(`${s.date}T${s.check_out_time}`):null;if(s.type==="plow"){const d={account_id:s.account_id,employee_id:s.employee_id,equipment_id:s.equipment_id||null,service_type:s.service_type,status:"completed",check_in_time:a?.toISOString()||null,check_out_time:c?.toISOString()||null,snow_depth_inches:s.snow_depth_inches||null,salt_used_lbs:s.salt_used_lbs||null,weather_conditions:s.weather_conditions||null,notes:s.notes||null};if(s.id){const{error:t}=await k.from("work_logs").update(d).eq("id",s.id);if(t)throw t;D.success("Work log updated successfully")}else{const{error:t}=await k.from("work_logs").insert(d);if(t)throw t;D.success("Work log created successfully")}}else{const d={account_id:s.account_id,employee_id:s.employee_id,service_type:s.service_type,status:"completed",check_in_time:a?.toISOString()||null,check_out_time:c?.toISOString()||null,snow_depth_inches:s.snow_depth_inches||null,ice_melt_used_lbs:s.ice_melt_used_lbs||null,weather_conditions:s.weather_conditions||null,notes:s.notes||null};if(s.id){const{error:t}=await k.from("shovel_work_logs").update(d).eq("id",s.id);if(t)throw t;D.success("Work log updated successfully")}else{const{error:t}=await k.from("shovel_work_logs").insert(d);if(t)throw t;D.success("Work log created successfully")}}Te(!1),qe(null),await re()}catch(a){console.error("Error saving work log:",a),D.error("Failed to save work log")}finally{q(!1)}},jt=async()=>{if(ne){q(!0);try{if(ne.type==="shift"){const{error:s}=await k.from("time_clock").delete().eq("id",ne.id);if(s)throw s;D.success("Shift deleted successfully")}else{const s=x.find(a=>a.id===ne.id);if(s){const a=s.type==="plow"?"work_logs":"shovel_work_logs",{error:c}=await k.from(a).delete().eq("id",ne.id);if(c)throw c;D.success("Work log deleted successfully")}}Me(!1),Re(null),await re()}catch(s){console.error("Error deleting:",s),D.error("Failed to delete")}finally{q(!1)}}},ft=async()=>{q(!0);try{if(Le==="shifts"){const s=Array.from(U);if(s.length===0)return;const{error:a}=await k.from("time_clock").delete().in("id",s);if(a)throw a;D.success(`${s.length} shift(s) deleted successfully`),le(new Set)}else{const s=Array.from(M);if(s.length===0)return;const a=x.filter(d=>s.includes(d.id)&&d.type==="plow").map(d=>d.id),c=x.filter(d=>s.includes(d.id)&&d.type==="shovel").map(d=>d.id);if(a.length>0){const{error:d}=await k.from("work_logs").delete().in("id",a);if(d)throw d}if(c.length>0){const{error:d}=await k.from("shovel_work_logs").delete().in("id",c);if(d)throw d}D.success(`${s.length} work log(s) deleted successfully`),r(new Set)}Ee(!1),await re()}catch(s){console.error("Error bulk deleting:",s),D.error("Failed to delete selected items")}finally{q(!1)}},yt=()=>{Qe("shifts"),Ee(!0)},vt=()=>{Qe("worklogs"),Ee(!0)},rs=async s=>{const a=Array.from(M);if(a.length!==0){q(!0);try{const c=x.filter(t=>a.includes(t.id)&&t.type==="plow").map(t=>t.id),d=x.filter(t=>a.includes(t.id)&&t.type==="shovel").map(t=>t.id);if(c.length>0){const{error:t}=await k.from("work_logs").update({billed:s}).in("id",c);if(t)throw t}if(d.length>0){const{error:t}=await k.from("shovel_work_logs").update({billed:s}).in("id",d);if(t)throw t}D.success(`${a.length} work log(s) marked as ${s?"billed":"unbilled"}`),r(new Set),await re()}catch(c){console.error("Error updating billed status:",c),D.error("Failed to update billed status")}finally{q(!1)}}},is=async s=>{q(!0);try{const a=s.type==="plow"?"work_logs":"shovel_work_logs",{error:c}=await k.from(a).update({billed:!s.billed}).eq("id",s.id);if(c)throw c;D.success(`Work log marked as ${s.billed?"unbilled":"billed"}`),await re()}catch(a){console.error("Error toggling billed status:",a),D.error("Failed to update billed status")}finally{q(!1)}},wt=()=>{Pe(null),Ae(!0)},gt=s=>{Pe(s),Ae(!0)},bt=s=>{const a=s.employee?`${s.employee.first_name} ${s.employee.last_name}`:"Unknown";Re({type:"shift",id:s.id,name:a}),Me(!0)},kt=()=>{qe(null),Te(!0)},cs=s=>{qe(s),Te(!0)},os=s=>{Re({type:"worklog",id:s.id,name:s.account_name}),Me(!0)};return n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ke,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/20 flex items-center justify-center",children:e.jsx(Ie,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Service Reports"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"View, edit, and export work logs"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{size:"sm",variant:"outline",onClick:mt,children:[e.jsx(Qt,{className:"h-4 w-4 mr-1"}),"Print"]}),e.jsxs(zt,{children:[e.jsx(Ht,{asChild:!0,children:e.jsxs(g,{size:"sm",className:"bg-primary hover:bg-primary/90",children:[e.jsx(xs,{className:"h-4 w-4 mr-1"}),"Export",e.jsx(Wt,{className:"h-3 w-3 ml-1"})]})}),e.jsxs(Ft,{align:"end",children:[e.jsxs(Fe,{onClick:ls,children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Export Work Logs PDF"]}),e.jsxs(Fe,{onClick:ht,children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),"Export Time Sheets"]}),e.jsxs(Fe,{onClick:ut,children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"Export Summary Report"]})]})]}),e.jsx(g,{size:"sm",variant:"outline",onClick:re,children:e.jsx(Ut,{className:"h-4 w-4"})})]})]}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/80 border-border/50",children:e.jsxs(ce,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Yt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Report Filters"})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"From Date"}),e.jsx(I,{type:"date",value:$,onChange:s=>G(s.target.value),className:"bg-[hsl(var(--background))] border-border/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"To Date"}),e.jsx(I,{type:"date",value:P,onChange:s=>X(s.target.value),className:"bg-[hsl(var(--background))] border-border/50"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Log Type"}),e.jsxs(R,{value:y,onValueChange:Y,children:[e.jsx(z,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Types"})}),e.jsxs(W,{children:[e.jsx(b,{value:"all",children:"All Types"}),e.jsx(b,{value:"plow",children:"Plow Only"}),e.jsx(b,{value:"shovel",children:"Shovel Only"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Account (Plow)"}),e.jsxs(R,{value:de,onValueChange:xe,children:[e.jsx(z,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Accounts"})}),e.jsxs(W,{children:[e.jsx(b,{value:"all",children:"All Accounts"}),S.filter(s=>s.id&&s.id.trim()!=="").map(s=>e.jsx(b,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Location (Shovel)"}),e.jsxs(R,{value:me,onValueChange:_e,children:[e.jsx(z,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Locations"})}),e.jsxs(W,{children:[e.jsx(b,{value:"all",children:"All Locations"}),S.filter(s=>s.id&&s.id.trim()!=="").map(s=>e.jsx(b,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Employee"}),e.jsxs(R,{value:J,onValueChange:je,children:[e.jsx(z,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Employees"})}),e.jsxs(W,{children:[e.jsx(b,{value:"all",children:"All Employees"}),N.filter(s=>s.id&&s.id.trim()!=="").map(s=>e.jsxs(b,{value:s.id,children:[s.first_name," ",s.last_name]},s.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Service Type"}),e.jsxs(R,{value:ee,onValueChange:fe,children:[e.jsx(z,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Types"})}),e.jsxs(W,{children:[e.jsx(b,{value:"all",children:"All Types"}),e.jsx(b,{value:"plow",children:"Plow"}),e.jsx(b,{value:"salt",children:"Salt"}),e.jsx(b,{value:"both",children:"Plow/Salt"}),e.jsx(b,{value:"shovel",children:"Shovel Walks"}),e.jsx(b,{value:"ice_melt",children:"Salt Walks"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Equipment"}),e.jsxs(R,{value:se,onValueChange:ye,children:[e.jsx(z,{className:"bg-[hsl(var(--background))] border-border/50",children:e.jsx(H,{placeholder:"All Equipment"})}),e.jsxs(W,{children:[e.jsx(b,{value:"all",children:"All Equipment"}),L.filter(s=>s.id&&s.id.trim()!=="").map(s=>e.jsx(b,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Min Snow (in)"}),e.jsx(I,{type:"number",placeholder:"Any",value:te,onChange:s=>ve(s.target.value),className:"bg-[hsl(var(--background))] border-border/50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{className:"text-sm text-muted-foreground",children:"Min Salt (lbs)"}),e.jsx(I,{type:"number",placeholder:"Any",value:he,onChange:s=>we(s.target.value),className:"bg-[hsl(var(--background))] border-border/50"})]})]}),e.jsx("div",{className:"text-center",children:e.jsx(g,{variant:"link",className:"text-muted-foreground text-sm",onClick:dt,children:"Clear All Filters"})})]})]})}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/80 border-border/50",children:e.jsxs(ce,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"font-medium",children:["Daily Shifts (",V.length," shifts)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[U.size>0&&e.jsxs(g,{size:"sm",variant:"destructive",onClick:yt,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Delete (",U.size,")"]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:wt,children:[e.jsx(hs,{className:"h-4 w-4 mr-1"}),"Add Shift"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ue,{children:[e.jsx(Ve,{children:e.jsxs(Z,{className:"border-border/50",children:[e.jsx(u,{className:"w-10",children:e.jsx(ge,{checked:U.size===V.length&&V.length>0,onCheckedChange:pt})}),e.jsx(u,{children:"Employee"}),e.jsx(u,{children:"Date"}),e.jsx(u,{children:"Start"}),e.jsx(u,{children:"End"}),e.jsx(u,{children:"Hours"}),e.jsx(u,{children:"Location"}),e.jsx(u,{children:"Actions"})]})}),e.jsxs(Be,{children:[V.slice(0,10).map(s=>e.jsxs(Z,{className:"border-border/30",children:[e.jsx(h,{children:e.jsx(ge,{checked:U.has(s.id),onCheckedChange:a=>{const c=new Set(U);a?c.add(s.id):c.delete(s.id),le(c)}})}),e.jsx(h,{className:"font-medium",children:s.employee?`${s.employee.first_name} ${s.employee.last_name}`:"Unknown"}),e.jsx(h,{children:v(new Date(s.clock_in_time),"MM/dd")}),e.jsx(h,{children:v(new Date(s.clock_in_time),"HH:mm")}),e.jsx(h,{children:s.clock_out_time?v(new Date(s.clock_out_time),"HH:mm"):"-"}),e.jsx(h,{children:e.jsx("span",{className:"text-cyan-400 cursor-pointer hover:underline",children:as(s.clock_in_time,s.clock_out_time)})}),e.jsx(h,{children:s.clock_in_latitude&&s.clock_in_longitude?e.jsxs(g,{variant:"link",size:"sm",className:"text-cyan-400 p-0 h-auto",children:[e.jsx(Vt,{className:"h-3 w-3 mr-1"}),"View"]}):"-"}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>gt(s),children:e.jsx(Ge,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>bt(s),children:e.jsx(De,{className:"h-3 w-3 text-red-400"})})]})})]},s.id)),V.length===0&&e.jsx(Z,{children:e.jsx(h,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No shifts found for the selected filters"})})]})]})})]})}),e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsx(ie,{className:"bg-[hsl(var(--card))]/50 border-border/30",children:e.jsxs(ce,{className:"py-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Total"}),e.jsx("p",{className:"text-3xl font-bold",children:B.total})]})}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/50 border-border/30",children:e.jsxs(ce,{className:"py-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Plow"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:B.plow})]})}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/50 border-border/30",children:e.jsxs(ce,{className:"py-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Shovel"}),e.jsx("p",{className:"text-3xl font-bold text-purple-400",children:B.shovel})]})}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/50 border-border/30",children:e.jsxs(ce,{className:"py-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Salt"}),e.jsx("p",{className:"text-3xl font-bold text-green-400",children:B.salt})]})}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/50 border-border/30",children:e.jsxs(ce,{className:"py-4 text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Locations"}),e.jsx("p",{className:"text-3xl font-bold text-orange-400",children:B.locations})]})})]}),e.jsx(ie,{className:"bg-[hsl(var(--card))]/80 border-border/50",children:e.jsx(ce,{className:"pt-6",children:e.jsxs(Bt,{value:ae,onValueChange:s=>{Se(s),r(new Set)},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(Gt,{children:[e.jsxs(us,{value:"current",className:"gap-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),"Current (",ct,")"]}),e.jsxs(us,{value:"archived",className:"gap-2",children:[e.jsx(_s,{className:"h-4 w-4"}),"Archived (",ot,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[M.size>0&&e.jsxs(e.Fragment,{children:[ae==="current"?e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>rs(!0),disabled:K,children:[e.jsx(js,{className:"h-4 w-4 mr-1"}),"Mark Billed (",M.size,")"]}):e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>rs(!1),disabled:K,children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),"Unarchive (",M.size,")"]}),e.jsxs(g,{size:"sm",variant:"destructive",onClick:vt,disabled:K,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),"Delete (",M.size,")"]})]}),e.jsxs(g,{size:"sm",variant:"outline",onClick:kt,children:[e.jsx(hs,{className:"h-4 w-4 mr-1"}),"Add Entry"]})]})]}),e.jsx(ps,{value:"current",className:"mt-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ue,{children:[e.jsx(Ve,{children:e.jsxs(Z,{className:"border-border/50",children:[e.jsx(u,{className:"w-10",children:e.jsx(ge,{checked:M.size===f.length&&f.length>0,onCheckedChange:ns})}),e.jsx(u,{children:"Type"}),e.jsx(u,{children:"Date"}),e.jsx(u,{children:"In"}),e.jsx(u,{children:"Out"}),e.jsx(u,{children:"Dur."}),e.jsx(u,{children:"Location"}),e.jsx(u,{children:"Service"}),e.jsx(u,{children:"Snow/Salt"}),e.jsx(u,{children:"Weather"}),e.jsx(u,{children:"Equipment"}),e.jsx(u,{children:"Crew"}),e.jsx(u,{children:"Photo"}),e.jsx(u,{children:"Actions"})]})}),e.jsxs(Be,{children:[f.slice(0,50).map(s=>e.jsxs(Z,{className:"border-border/30",children:[e.jsx(h,{children:e.jsx(ge,{checked:M.has(s.id),onCheckedChange:a=>{const c=new Set(M);a?c.add(s.id):c.delete(s.id),r(c)}})}),e.jsx(h,{children:e.jsx(Oe,{className:s.type==="plow"?"bg-blue-600":"bg-purple-600",children:s.type==="plow"?"Plow":"Shov"})}),e.jsx(h,{children:v(new Date(s.date),"MM/dd")}),e.jsx(h,{children:s.check_in_time?v(new Date(s.check_in_time),"HH:mm"):"-"}),e.jsx(h,{children:s.check_out_time?v(new Date(s.check_out_time),"HH:mm"):"-"}),e.jsx(h,{children:We(s.check_in_time,s.check_out_time)}),e.jsx(h,{className:"max-w-[100px] truncate",title:s.account_name,children:s.account_name}),e.jsx(h,{children:e.jsx(Oe,{variant:"outline",className:s.service_type==="plow"?"border-blue-500 text-blue-400":s.service_type==="salt"||s.service_type==="ice_melt"?"border-green-500 text-green-400":s.service_type==="shovel"?"border-purple-500 text-purple-400":"border-cyan-500 text-cyan-400",children:s.type==="plow"?s.service_type==="both"?"Plow/Salt":s.service_type==="plow"?"Plow":s.service_type==="salt"?"Salt":s.service_type:s.service_type==="both"?"Shovel/Salt":s.service_type==="ice_melt"?"Salt":s.service_type==="shovel"?"Shovel":s.service_type})}),e.jsxs(h,{className:"text-sm",children:[s.snow_depth_inches!==null?`${s.snow_depth_inches}"`:"-"," / "," ",s.salt_used_lbs!==null?`${s.salt_used_lbs}lb`:s.ice_melt_used_lbs!==null?`${s.ice_melt_used_lbs}lb`:"-"]}),e.jsx(h,{className:"max-w-[80px] truncate text-sm",title:s.weather_conditions||"-",children:s.weather_conditions||"-"}),e.jsx(h,{className:"max-w-[80px] truncate text-sm",title:s.equipment_name||"-",children:s.equipment_name||"-"}),e.jsx(h,{className:"max-w-[100px] truncate text-sm",title:s.team_member_names.join(", ")||s.employee_name,children:s.team_member_names.length>0?s.team_member_names.join(", "):s.employee_name}),e.jsx(h,{children:e.jsx(ys,{photoPaths:s.photo_urls||[],onViewPhotos:ts})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>is(s),title:"Mark as billed",disabled:K,children:e.jsx(js,{className:"h-3 w-3 text-green-500"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>cs(s),children:e.jsx(Ge,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>os(s),children:e.jsx(De,{className:"h-3 w-3 text-red-400"})})]})})]},s.id)),f.length===0&&e.jsx(Z,{children:e.jsx(h,{colSpan:14,className:"text-center text-muted-foreground py-8",children:"No unbilled work logs found"})})]})]})})}),e.jsx(ps,{value:"archived",className:"mt-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ue,{children:[e.jsx(Ve,{children:e.jsxs(Z,{className:"border-border/50",children:[e.jsx(u,{className:"w-10",children:e.jsx(ge,{checked:M.size===f.length&&f.length>0,onCheckedChange:ns})}),e.jsx(u,{children:"Type"}),e.jsx(u,{children:"Date"}),e.jsx(u,{children:"In"}),e.jsx(u,{children:"Out"}),e.jsx(u,{children:"Dur."}),e.jsx(u,{children:"Location"}),e.jsx(u,{children:"Service"}),e.jsx(u,{children:"Snow/Salt"}),e.jsx(u,{children:"Weather"}),e.jsx(u,{children:"Equipment"}),e.jsx(u,{children:"Crew"}),e.jsx(u,{children:"Photo"}),e.jsx(u,{children:"Actions"})]})}),e.jsxs(Be,{children:[f.slice(0,50).map(s=>e.jsxs(Z,{className:"border-border/30 opacity-75",children:[e.jsx(h,{children:e.jsx(ge,{checked:M.has(s.id),onCheckedChange:a=>{const c=new Set(M);a?c.add(s.id):c.delete(s.id),r(c)}})}),e.jsx(h,{children:e.jsx(Oe,{className:s.type==="plow"?"bg-blue-600":"bg-purple-600",children:s.type==="plow"?"Plow":"Shov"})}),e.jsx(h,{children:v(new Date(s.date),"MM/dd")}),e.jsx(h,{children:s.check_in_time?v(new Date(s.check_in_time),"HH:mm"):"-"}),e.jsx(h,{children:s.check_out_time?v(new Date(s.check_out_time),"HH:mm"):"-"}),e.jsx(h,{children:We(s.check_in_time,s.check_out_time)}),e.jsx(h,{className:"max-w-[100px] truncate",title:s.account_name,children:s.account_name}),e.jsx(h,{children:e.jsx(Oe,{variant:"outline",className:s.service_type==="plow"?"border-blue-500 text-blue-400":s.service_type==="salt"||s.service_type==="ice_melt"?"border-green-500 text-green-400":s.service_type==="shovel"?"border-purple-500 text-purple-400":"border-cyan-500 text-cyan-400",children:s.type==="plow"?s.service_type==="both"?"Plow/Salt":s.service_type==="plow"?"Plow":s.service_type==="salt"?"Salt":s.service_type:s.service_type==="both"?"Shovel/Salt":s.service_type==="ice_melt"?"Salt":s.service_type==="shovel"?"Shovel":s.service_type})}),e.jsxs(h,{className:"text-sm",children:[s.snow_depth_inches!==null?`${s.snow_depth_inches}"`:"-"," / "," ",s.salt_used_lbs!==null?`${s.salt_used_lbs}lb`:s.ice_melt_used_lbs!==null?`${s.ice_melt_used_lbs}lb`:"-"]}),e.jsx(h,{className:"max-w-[80px] truncate text-sm",title:s.weather_conditions||"-",children:s.weather_conditions||"-"}),e.jsx(h,{className:"max-w-[80px] truncate text-sm",title:s.equipment_name||"-",children:s.equipment_name||"-"}),e.jsx(h,{className:"max-w-[100px] truncate text-sm",title:s.team_member_names.join(", ")||s.employee_name,children:s.team_member_names.length>0?s.team_member_names.join(", "):s.employee_name}),e.jsx(h,{children:e.jsx(ys,{photoPaths:s.photo_urls||[],onViewPhotos:ts})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>is(s),title:"Mark as unbilled",disabled:K,children:e.jsx(_s,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>cs(s),children:e.jsx(Ge,{className:"h-3 w-3 text-muted-foreground"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>os(s),children:e.jsx(De,{className:"h-3 w-3 text-red-400"})})]})})]},s.id)),f.length===0&&e.jsx(Z,{children:e.jsx(h,{colSpan:14,className:"text-center text-muted-foreground py-8",children:"No archived work logs found"})})]})]})})})]})})}),e.jsx(sa,{open:Qs,onOpenChange:Ae,employees:N,initialData:tt,onSave:xt,isLoading:K}),e.jsx(ta,{open:Xs,onOpenChange:Te,accounts:S,employees:N,equipment:L,initialData:O?{id:O.id,type:O.type,account_id:O.account_id,employee_id:O.employee_id,equipment_id:O.equipment_id||void 0,service_type:O.service_type,check_in_time:O.check_in_time,check_out_time:O.check_out_time,snow_depth_inches:O.snow_depth_inches,salt_used_lbs:O.salt_used_lbs,ice_melt_used_lbs:O.ice_melt_used_lbs,weather_conditions:O.weather_conditions,notes:O.notes}:null,onSave:_t,isLoading:K}),e.jsx(fs,{open:et,onOpenChange:Me,title:ne?.type==="shift"?"Delete Shift":"Delete Work Log",description:`Are you sure you want to delete this ${ne?.type==="shift"?"shift":"work log"} for "${ne?.name}"? This action cannot be undone.`,onConfirm:jt,isLoading:K}),e.jsx(fs,{open:st,onOpenChange:Ee,title:Le==="shifts"?`Delete ${U.size} Shifts`:`Delete ${M.size} Work Logs`,description:`Are you sure you want to delete ${Le==="shifts"?U.size:M.size} selected ${Le==="shifts"?"shift(s)":"work log(s)"}? This action cannot be undone.`,onConfirm:ft,isLoading:K}),e.jsx(Je,{open:at,onOpenChange:Xe,children:e.jsxs(Ye,{className:"max-w-3xl",children:[e.jsx(Ke,{children:e.jsx(Ze,{children:es?"Loading photos...":`Photo ${ze+1} of ${ue.length}`})}),es?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ke,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):ue.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:ue[ze],alt:`Photo ${ze+1}`,className:"w-full h-auto max-h-[70vh] object-contain rounded-lg"}),ue.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"secondary",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2",onClick:it,children:e.jsx(Zt,{className:"h-4 w-4"})}),e.jsx(g,{variant:"secondary",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2",onClick:rt,children:e.jsx(Jt,{className:"h-4 w-4"})})]})]}):e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No photos available"})]})})]})}export{ba as default};
