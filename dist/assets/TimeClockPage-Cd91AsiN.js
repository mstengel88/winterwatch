import{c as G,W as V,X as z,Y as U,r as o,Z as H,j as e,A as Q,i as W,C as u,Q as x,R as h,g as f,_ as X,$ as Y,B as k,I as Z,S as J,p as K,q as ee,t as se,v as y,L as I,w as $,P as te,T as ae,k as le,l as re,U as ce,s as A,V as D}from"./index-CnGaZqSN.js";import{T as oe,a as ie,b as M,c as n,d as ne,e as d}from"./table-Cg0xew9Q.js";import{S as de}from"./search-Di4xWTr4.js";import{C as me,s as ue,e as xe}from"./subDays-BHzbpdNt.js";import{P as he}from"./pencil-BlT1alPn.js";import{M as fe}from"./map-pin-CNhKVerA.js";const pe=G("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);function ge(c,p,g){const i=V(c,p)/z;return U(g?.roundingMethod)(i)}function je({clockInTime:c}){const[p,g]=o.useState("");return o.useEffect(()=>{const i=()=>{const S=new Date(c).getTime(),_=Date.now()-S,b=Math.floor(_/(1e3*60*60)),v=Math.floor(_%(1e3*60*60)/(1e3*60)),w=Math.floor(_%(1e3*60)/1e3);g(`${b.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}`)};i();const j=setInterval(i,1e3);return()=>clearInterval(j)},[c]),e.jsx("span",{className:"font-mono tabular-nums",children:p})}function Se(){const[c,p]=o.useState([]),[g,i]=o.useState(!0),[j,S]=o.useState(""),[N,_]=o.useState("7"),[b,v]=o.useState(null),w=async()=>{i(!0);try{const s=parseInt(N),t=ce(ue(new Date,s-1)).toISOString(),a=xe(new Date).toISOString(),{data:l,error:r}=await A.from("time_clock").select("*, employee:employees(first_name, last_name), created_at, updated_at").gte("clock_in_time",t).lte("clock_in_time",a).order("clock_in_time",{ascending:!1});if(r)throw r;p(l||[])}catch(s){console.error("Error fetching time entries:",s),D.error("Failed to load time entries")}finally{i(!1)}};o.useEffect(()=>{w()},[N]);const O=async s=>{v(s);try{let t=null;if(navigator.geolocation)try{const r=await new Promise((m,R)=>{navigator.geolocation.getCurrentPosition(m,R,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})});t={latitude:r.coords.latitude,longitude:r.coords.longitude}}catch(r){console.warn("Could not get GPS location:",r)}const a={clock_out_time:new Date().toISOString()};t&&(a.clock_out_latitude=t.latitude,a.clock_out_longitude=t.longitude);const{error:l}=await A.from("time_clock").update(a).eq("id",s);if(l)throw l;D.success("Employee clocked out successfully"+(t?" with GPS":"")),w()}catch(t){console.error("Error clocking out:",t),D.error("Failed to clock out employee")}finally{v(null)}},T=c.filter(s=>{if(!j)return!0;const t=j.toLowerCase();return(s.employee?`${s.employee.first_name} ${s.employee.last_name}`.toLowerCase():"").includes(t)}),C=(()=>{const s=new Map;return c.forEach(t=>{if(!t.employee)return;const a=`${t.employee.first_name} ${t.employee.last_name}`,l=s.get(a)||{name:a,totalHours:0,shifts:0,isActive:!1};if(t.clock_in_time){const r=t.clock_out_time?new Date(t.clock_out_time):new Date,m=H(r,new Date(t.clock_in_time))/60;l.totalHours+=m,l.shifts+=1,t.clock_out_time||(l.isActive=!0)}s.set(a,l)}),Array.from(s.values()).sort((t,a)=>a.totalHours-t.totalHours)})(),P=C.reduce((s,t)=>s+t.totalHours,0),F=c.filter(s=>!s.clock_out_time).length,q=new Set(c.map(s=>s.employee_id)).size,B=(s,t)=>{const a=new Date(s),l=t?new Date(t):new Date,r=ge(l,a),m=H(l,a)%60;return r>0?`${r}h ${m}m`:`${m}m`},E=s=>{if(!s.updated_at)return!1;const t=new Date(s.updated_at).getTime(),a=s.clock_out_time?new Date(s.clock_out_time).getTime():new Date(s.clock_in_time).getTime();return t-a>5e3},L=s=>s?$(new Date(s),"h:mm a"):"-";return e.jsx(Q,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(W,{className:"h-6 w-6 text-primary"}),"Time Clock"]}),e.jsx("p",{className:"text-muted-foreground",children:"Track employee work hours and shifts"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(u,{className:"bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20",children:[e.jsx(x,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-muted-foreground",children:"Total Hours"})}),e.jsxs(f,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[P.toFixed(1),"h"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last ",N," days"]})]})]}),e.jsxs(u,{className:"bg-gradient-to-br from-green-500/10 to-green-500/5 border-green-500/20",children:[e.jsx(x,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-muted-foreground",children:"Active Shifts"})}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:F}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently clocked in"})]})]}),e.jsxs(u,{className:"bg-gradient-to-br from-blue-500/10 to-blue-500/5 border-blue-500/20",children:[e.jsx(x,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-muted-foreground",children:"Employees"})}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-500",children:q}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active this period"})]})]}),e.jsxs(u,{className:"bg-gradient-to-br from-purple-500/10 to-purple-500/5 border-purple-500/20",children:[e.jsx(x,{className:"pb-2",children:e.jsx(h,{className:"text-sm font-medium text-muted-foreground",children:"Shifts Logged"})}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-500",children:c.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total entries"})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs(u,{className:"bg-card/50 border-border/50",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"text-base flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Employee Hours"]}),e.jsx(Y,{children:"Total hours per employee"})]}),e.jsx(f,{children:C.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-6",children:"No data available"}):e.jsx("div",{className:"space-y-3",children:C.slice(0,8).map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.isActive&&e.jsx("span",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.shifts," shifts"]}),e.jsxs(k,{variant:"outline",children:[s.totalHours.toFixed(1),"h"]})]})]},s.name))})})]}),e.jsxs(u,{className:"lg:col-span-2 bg-card/50 border-border/50",children:[e.jsx(x,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx(h,{className:"text-base",children:"Time Entries"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 sm:w-[200px]",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Z,{placeholder:"Search employee...",value:j,onChange:s=>S(s.target.value),className:"pl-9 bg-background/50"})]}),e.jsxs(J,{value:N,onValueChange:_,children:[e.jsxs(K,{className:"w-[130px] bg-background/50",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),e.jsx(ee,{})]}),e.jsxs(se,{children:[e.jsx(y,{value:"7",children:"Last 7 days"}),e.jsx(y,{value:"14",children:"Last 14 days"}),e.jsx(y,{value:"30",children:"Last 30 days"})]})]})]})]})}),e.jsx(f,{children:g?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):T.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No time entries found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(oe,{children:[e.jsx(ie,{children:e.jsxs(M,{className:"border-border/50 hover:bg-transparent",children:[e.jsx(n,{children:"Employee"}),e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Clock In"}),e.jsx(n,{children:"Clock Out"}),e.jsx(n,{children:"Duration"}),e.jsx(n,{children:"Status"}),e.jsx(n,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(ne,{children:T.slice(0,15).map(s=>e.jsxs(M,{className:`border-border/50 ${E(s)?"bg-destructive/10":""}`,children:[e.jsx(d,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.employee?`${s.employee.first_name} ${s.employee.last_name}`:"-",E(s)&&e.jsxs(k,{variant:"outline",className:"text-destructive border-destructive/50 gap-1 text-xs",children:[e.jsx(he,{className:"h-3 w-3"}),"Edited"]})]})}),e.jsx(d,{children:$(new Date(s.clock_in_time),"MM/dd/yy")}),e.jsxs(d,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3 text-green-500"}),L(s.clock_in_time)]}),s.clock_in_latitude&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(fe,{className:"h-3 w-3"}),"GPS recorded"]})]}),e.jsx(d,{children:s.clock_out_time?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3 text-red-500"}),L(s.clock_out_time)]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ae,{className:"h-3 w-3 text-muted-foreground"}),s.clock_out_time?B(s.clock_in_time,s.clock_out_time):e.jsx(je,{clockInTime:s.clock_in_time})]})}),e.jsx(d,{children:s.clock_out_time?e.jsx(k,{variant:"outline",children:"Completed"}):e.jsxs(k,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-green-400 mr-1.5 animate-pulse"}),"Active"]})}),e.jsx(d,{children:!s.clock_out_time&&e.jsx(le,{size:"sm",variant:"destructive",onClick:()=>O(s.id),disabled:b===s.id,className:"h-7 px-2",children:b===s.id?e.jsx(I,{className:"h-3 w-3 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Clock Out"]})})})]},s.id))})]})})})]})]})]})})}export{Se as default};
