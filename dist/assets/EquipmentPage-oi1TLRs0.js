import{r as i,j as e,L as M,k as x,C as h,g as u,I as d,ao as R,M as Y,aq as Q,ar as $,as as H,at as q,o as n,S,p as _,q as w,t as C,v as E,z as G,s as f,V as o,B as p}from"./index-CnGaZqSN.js";import{S as J}from"./switch-CwE6flQa.js";import{D as K,a as W,b as X,c as Z,d as ee,e as se}from"./dialog-Hlo-k202.js";import{U as ae,E as te,b as re,g as le}from"./validations-DmyGT4_y.js";import{S as ne}from"./search-Di4xWTr4.js";import{P as ie}from"./pencil-BlT1alPn.js";import{T as ce}from"./trash-2-CZ7AlvHE.js";const de=["Plow Truck","Salt Truck","Loader","Skid Steer","Quadaxle","Box Truck","Semi","Other"],oe=["available","in_use","maintenance","out_of_service"],me=["plow","salt","both"];function Ne(){const[c,P]=i.useState([]),[L,k]=i.useState(!0),[O,j]=i.useState(!1),[m,T]=i.useState(null),[D,F]=i.useState(!1),[g,A]=i.useState(""),[t,r]=i.useState({name:"",type:"Plow Truck",make:"",model:"",year:"",license_plate:"",vin:"",status:"available",service_type:"both",notes:"",is_active:!0}),y=async()=>{k(!0);try{const{data:s,error:a}=await f.from("equipment").select("*").order("name");if(a)throw a;P(s||[])}catch(s){console.error("Error fetching equipment:",s),o.error("Failed to load equipment")}finally{k(!1)}};i.useEffect(()=>{y()},[]);const I=s=>{s?(T(s),r({name:s.name,type:s.type,make:s.make||"",model:s.model||"",year:s.year?.toString()||"",license_plate:s.license_plate||"",vin:s.vin||"",status:s.status||"available",service_type:s.service_type||"both",notes:s.notes||"",is_active:s.is_active})):(T(null),r({name:"",type:"Plow Truck",make:"",model:"",year:"",license_plate:"",vin:"",status:"available",service_type:"both",notes:"",is_active:!0})),j(!0)},V=async()=>{const s=re.safeParse(t);if(!s.success){o.error(le(s.error));return}F(!0);try{const a=s.data,N={name:a.name,type:a.type,make:a.make||null,model:a.model||null,year:a.year?parseInt(a.year):null,license_plate:a.license_plate||null,vin:a.vin||null,status:a.status,service_type:t.service_type,notes:a.notes||null,is_active:a.is_active};if(m){const{error:l}=await f.from("equipment").update(N).eq("id",m.id);if(l)throw l;o.success("Equipment updated")}else{const{error:l}=await f.from("equipment").insert(N);if(l)throw l;o.success("Equipment created")}j(!1),y()}catch(a){console.error("Error saving equipment:",a),o.error("Failed to save equipment")}finally{F(!1)}},U=async s=>{if(confirm("Are you sure you want to delete this equipment?"))try{const{error:a}=await f.from("equipment").delete().eq("id",s);if(a)throw a;o.success("Equipment deleted"),y()}catch(a){console.error("Error deleting equipment:",a),o.error("Failed to delete equipment")}},b=i.useMemo(()=>{if(!g)return c;const s=g.toLowerCase();return c.filter(a=>a.name.toLowerCase().includes(s)||a.type.toLowerCase().includes(s))},[c,g]),v=i.useMemo(()=>{const s=c.filter(l=>l.status==="available"||l.status==="in_use").length,a=c.filter(l=>l.status==="maintenance").length,N=c.filter(l=>l.status==="out_of_service").length;return{total:c.length,active:s,maintenance:a,overdue:N}},[c]),B=s=>{switch(s){case"available":case"in_use":return e.jsx(p,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Active"});case"maintenance":return e.jsx(p,{className:"bg-orange-500/20 text-orange-400 border-orange-500/30",children:"Maintenance"});case"out_of_service":return e.jsx(p,{variant:"destructive",children:"Out of Service"});default:return e.jsx(p,{variant:"outline",children:s||"Unknown"})}},z=s=>e.jsx(p,{variant:"outline",className:"bg-muted/50",children:s});return L?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Equipment"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage vehicles and equipment inventory"})]}),e.jsxs(x,{variant:"outline",className:"gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Import CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(h,{className:"bg-card/50 border-border/50",children:e.jsxs(u,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold",children:v.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Equipment"})]})}),e.jsx(h,{className:"bg-card/50 border-border/50",children:e.jsxs(u,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:v.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active"})]})}),e.jsx(h,{className:"bg-card/50 border-border/50",children:e.jsxs(u,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-400",children:v.maintenance}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"In Maintenance"})]})}),e.jsx(h,{className:"bg-card/50 border-border/50",children:e.jsxs(u,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-destructive",children:v.overdue}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Overdue Service"})]})})]}),e.jsx(h,{className:"bg-card/50 border-border/50",children:e.jsxs(u,{className:"pt-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Search equipment...",value:g,onChange:s=>A(s.target.value),className:"pl-9 bg-muted/30 border-border/50"})]}),e.jsxs(x,{onClick:()=>I(),className:"gap-2 bg-primary hover:bg-primary/90",children:[e.jsx(R,{className:"h-4 w-4"}),"Add Equipment"]})]}),e.jsx("div",{className:"rounded-lg border border-border/50 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/30",children:e.jsxs("tr",{className:"text-left text-sm text-muted-foreground",children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Type"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Details"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Service"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Maintenance"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-border/50",children:[b.map(s=>e.jsxs("tr",{className:"hover:bg-muted/20 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx("td",{className:"px-4 py-3",children:z(s.type)}),e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:s.make||s.model?`${s.make||""} ${s.model||""}`.trim():"-"}),e.jsx("td",{className:"px-4 py-3 text-sm capitalize",children:s.service_type||"both"}),e.jsx("td",{className:"px-4 py-3 text-sm text-muted-foreground",children:"-"}),e.jsx("td",{className:"px-4 py-3",children:B(s.status)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs(Q,{children:[e.jsx($,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsxs(H,{align:"end",children:[e.jsxs(q,{onClick:()=>I(s),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(q,{onClick:()=>U(s.id),className:"text-destructive",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},s.id)),b.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-8 text-center text-muted-foreground",children:"No equipment found"})})]})]})}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-4",children:["Showing ",b.length," of ",c.length," results"]})]})}),e.jsx(K,{open:O,onOpenChange:j,children:e.jsxs(W,{className:"max-w-lg",children:[e.jsxs(X,{children:[e.jsx(Z,{children:m?"Edit Equipment":"Add Equipment"}),e.jsx(ee,{children:m?"Update equipment details":"Add a new vehicle or equipment"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Name *"}),e.jsx(d,{id:"name",value:t.name,onChange:s=>r({...t,name:s.target.value}),placeholder:"e.g., Truck #1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Type *"}),e.jsxs(S,{value:t.type,onValueChange:s=>r({...t,type:s}),children:[e.jsx(_,{children:e.jsx(w,{})}),e.jsx(C,{children:de.map(s=>e.jsx(E,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"make",children:"Make"}),e.jsx(d,{id:"make",value:t.make,onChange:s=>r({...t,make:s.target.value}),placeholder:"Ford"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"model",children:"Model"}),e.jsx(d,{id:"model",value:t.model,onChange:s=>r({...t,model:s.target.value}),placeholder:"F-350"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"year",children:"Year"}),e.jsx(d,{id:"year",type:"number",value:t.year,onChange:s=>r({...t,year:s.target.value}),placeholder:"2023"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"license_plate",children:"License Plate"}),e.jsx(d,{id:"license_plate",value:t.license_plate,onChange:s=>r({...t,license_plate:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"vin",children:"VIN"}),e.jsx(d,{id:"vin",value:t.vin,onChange:s=>r({...t,vin:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Status"}),e.jsxs(S,{value:t.status,onValueChange:s=>r({...t,status:s}),children:[e.jsx(_,{children:e.jsx(w,{})}),e.jsx(C,{children:oe.map(s=>e.jsx(E,{value:s,children:e.jsx("span",{className:"capitalize",children:s.replace("_"," ")})},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Service"}),e.jsxs(S,{value:t.service_type,onValueChange:s=>r({...t,service_type:s}),children:[e.jsx(_,{children:e.jsx(w,{})}),e.jsx(C,{children:me.map(s=>e.jsx(E,{value:s,children:e.jsx("span",{className:"capitalize",children:s})},s))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(J,{id:"is_active",checked:t.is_active,onCheckedChange:s=>r({...t,is_active:s})}),e.jsx(n,{htmlFor:"is_active",children:"Active"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"notes",children:"Notes"}),e.jsx(G,{id:"notes",value:t.notes,onChange:s=>r({...t,notes:s.target.value}),placeholder:"Maintenance notes, special instructions, etc."})]})]}),e.jsxs(se,{children:[e.jsx(x,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsxs(x,{onClick:V,disabled:D,children:[D&&e.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}),m?"Update":"Create"]})]})]})})]})}export{Ne as default};
