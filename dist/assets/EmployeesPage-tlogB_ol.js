import{r as l,j as e,L as F,_ as u,H as Q,J as W,K as L,O as P,C as d,g as m,k as p,I as h,ao as X,B as g,M as I,E as Y,aq as Z,ar as ee,as as se,at as A,o as c,S as M,p as k,q as R,t as U,v as _,s as j,V as i}from"./index-CnGaZqSN.js";import{D as ae,a as re,b as te,c as le,d as oe,e as ne}from"./dialog-Hlo-k202.js";import{U as ce,E as ie,e as de,g as me}from"./validations-DmyGT4_y.js";import{S as he}from"./search-Di4xWTr4.js";import{P as xe}from"./pencil-BlT1alPn.js";import{T as ue}from"./trash-2-CZ7AlvHE.js";const pe=["plow","shovel","both"];function be(){const[o,V]=l.useState([]),[O,q]=l.useState([]),[z,C]=l.useState(!0),[B,f]=l.useState(!1),[x,S]=l.useState(null),[E,D]=l.useState(!1),[y,H]=l.useState(""),[$,G]=l.useState("employees"),[r,n]=l.useState({first_name:"",last_name:"",email:"",phone:"",category:"both",hourly_rate:"",user_id:""}),b=async()=>{C(!0);try{const[s,a]=await Promise.all([j.from("employees").select("*").order("last_name"),j.from("profiles").select("*")]);if(s.error)throw s.error;if(a.error)throw a.error;V(s.data||[]),q(a.data||[])}catch(s){console.error("Error fetching data:",s),i.error("Failed to load employees")}finally{C(!1)}};l.useEffect(()=>{b()},[]);const T=s=>{s?(S(s),n({first_name:s.first_name,last_name:s.last_name,email:s.email||"",phone:s.phone||"",category:s.category,hourly_rate:s.hourly_rate?.toString()||"",user_id:s.user_id||""})):(S(null),n({first_name:"",last_name:"",email:"",phone:"",category:"both",hourly_rate:"",user_id:""})),f(!0)},J=async()=>{const s=de.safeParse(r);if(!s.success){i.error(me(s.error));return}D(!0);try{const a=s.data,v={first_name:a.first_name,last_name:a.last_name,email:a.email||null,phone:a.phone||null,category:a.category,hourly_rate:a.hourly_rate?parseFloat(a.hourly_rate):null,user_id:a.user_id||null};if(x){const{error:t}=await j.from("employees").update(v).eq("id",x.id);if(t)throw t;i.success("Employee updated")}else{const{error:t}=await j.from("employees").insert(v);if(t)throw t;i.success("Employee created")}f(!1),b()}catch(a){console.error("Error saving employee:",a),i.error("Failed to save employee")}finally{D(!1)}},K=async s=>{if(confirm("Are you sure you want to delete this employee?"))try{const{error:a}=await j.from("employees").delete().eq("id",s);if(a)throw a;i.success("Employee deleted"),b()}catch(a){console.error("Error deleting employee:",a),i.error("Failed to delete employee")}},w=l.useMemo(()=>{if(!y)return o;const s=y.toLowerCase();return o.filter(a=>`${a.first_name} ${a.last_name}`.toLowerCase().includes(s)||a.email?.toLowerCase().includes(s))},[o,y]),N=l.useMemo(()=>{const s=o.filter(t=>t.is_active).length,a=o.filter(t=>t.category==="plow"||t.category==="both").length,v=o.filter(t=>t.category==="shovel"||t.category==="both").length;return{total:o.length,active:s,plow:a,shovel:v}},[o]);return z?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Team Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage employees and user accounts"})]})]}),e.jsxs(Q,{value:$,onValueChange:G,children:[e.jsxs(W,{className:"bg-muted/30 border border-border/50",children:[e.jsxs(L,{value:"employees",className:"data-[state=active]:bg-secondary gap-2",children:[e.jsx(u,{className:"h-4 w-4"}),"Employees"]}),e.jsxs(L,{value:"users",className:"data-[state=active]:bg-secondary gap-2",children:[e.jsx(u,{className:"h-4 w-4"}),"Users & Roles"]})]}),e.jsxs(P,{value:"employees",className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(d,{className:"bg-card/50 border-border/50",children:e.jsxs(m,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold",children:N.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total"})]})}),e.jsx(d,{className:"bg-card/50 border-border/50",children:e.jsxs(m,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:N.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active"})]})}),e.jsx(d,{className:"bg-card/50 border-border/50",children:e.jsxs(m,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:N.plow}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Plow"})]})}),e.jsx(d,{className:"bg-card/50 border-border/50",children:e.jsxs(m,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-shovel",children:N.shovel}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Shovel"})]})})]}),e.jsxs(p,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Import"]}),e.jsx(d,{className:"bg-card/50 border-border/50",children:e.jsxs(m,{className:"pt-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search employees...",value:y,onChange:s=>H(s.target.value),className:"pl-9 bg-muted/30 border-border/50"})]}),e.jsxs(p,{onClick:()=>T(),className:"gap-2 bg-primary hover:bg-primary/90",children:[e.jsx(X,{className:"h-4 w-4"}),"Add Employee"]})]}),e.jsx("div",{className:"rounded-lg border border-border/50 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/30",children:e.jsxs("tr",{className:"text-left text-sm text-muted-foreground",children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Type"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-border/50",children:[w.map(s=>e.jsxs("tr",{className:"hover:bg-muted/20 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-muted/50 flex items-center justify-center",children:e.jsx(u,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("span",{className:"font-medium",children:[s.first_name," ",s.last_name]})]})}),e.jsxs("td",{className:"px-4 py-3",children:[s.category==="plow"&&e.jsxs(g,{className:"bg-primary/20 text-primary border-primary/30 gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),"Plow"]}),s.category==="shovel"&&e.jsxs(g,{className:"bg-shovel/20 text-shovel border-shovel/30 gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),"Shovel"]}),s.category==="both"&&e.jsx("div",{className:"flex gap-1",children:e.jsxs(g,{className:"bg-primary/20 text-primary border-primary/30 gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),"Plow"]})})]}),e.jsx("td",{className:"px-4 py-3",children:s.is_active?e.jsx(g,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Active"}):e.jsx(g,{variant:"outline",className:"text-muted-foreground",children:"Inactive"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(ie,{className:"h-4 w-4"})})}),e.jsxs(se,{align:"end",children:[e.jsxs(A,{onClick:()=>T(s),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(A,{onClick:()=>K(s.id),className:"text-destructive",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},s.id)),w.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-8 text-center text-muted-foreground",children:"No employees found"})})]})]})}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-4",children:["Showing ",w.length," of ",o.length," results"]})]})})]}),e.jsx(P,{value:"users",className:"mt-6",children:e.jsx(d,{className:"bg-card/50 border-border/50",children:e.jsxs(m,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(u,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"User & Role management coming soon"})]})})})]}),e.jsx(ae,{open:B,onOpenChange:f,children:e.jsxs(re,{children:[e.jsxs(te,{children:[e.jsx(le,{children:x?"Edit Employee":"Add Employee"}),e.jsx(oe,{children:x?"Update employee information":"Create a new employee record"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"first_name",children:"First Name *"}),e.jsx(h,{id:"first_name",value:r.first_name,onChange:s=>n({...r,first_name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(h,{id:"last_name",value:r.last_name,onChange:s=>n({...r,last_name:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:r.email,onChange:s=>n({...r,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"phone",children:"Phone"}),e.jsx(h,{id:"phone",value:r.phone,onChange:s=>n({...r,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Category"}),e.jsxs(M,{value:r.category,onValueChange:s=>n({...r,category:s}),children:[e.jsx(k,{children:e.jsx(R,{})}),e.jsx(U,{children:pe.map(s=>e.jsx(_,{value:s,children:e.jsx("span",{className:"capitalize",children:s})},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"hourly_rate",children:"Hourly Rate ($)"}),e.jsx(h,{id:"hourly_rate",type:"number",step:"0.01",value:r.hourly_rate,onChange:s=>n({...r,hourly_rate:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Link to User Account"}),e.jsxs(M,{value:r.user_id||"none",onValueChange:s=>n({...r,user_id:s==="none"?"":s}),children:[e.jsx(k,{children:e.jsx(R,{placeholder:"Select user account (optional)"})}),e.jsxs(U,{children:[e.jsx(_,{value:"none",children:"None"}),O.map(s=>e.jsx(_,{value:s.id,children:s.full_name||s.email||s.id},s.id))]})]})]})]}),e.jsxs(ne,{children:[e.jsx(p,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsxs(p,{onClick:J,disabled:E,children:[E&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),x?"Update":"Create"]})]})]})})]})}export{be as default};
