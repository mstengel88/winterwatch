import{r as n,j as e,L as F,k as h,C as b,g as _,I as c,ao as oe,y as O,au as de,B as x,aq as he,ar as me,as as xe,at as V,o as r,S as I,p as E,q as P,t as B,v as j,z as ue,s as v,V as d}from"./index-CnGaZqSN.js";import{S as pe}from"./switch-CwE6flQa.js";import{D as U,a as $,b as q,c as R,d as W,e as G}from"./dialog-Hlo-k202.js";import{U as ge,E as je,a as ve,g as ye}from"./validations-DmyGT4_y.js";import{S as fe}from"./search-Di4xWTr4.js";import{P as H}from"./pencil-BlT1alPn.js";import{T as Y}from"./trash-2-CZ7AlvHE.js";import{M as Ne}from"./map-pin-CNhKVerA.js";const be=["plow","shovel","both"];function Fe(){const[m,Z]=n.useState([]),[J,L]=n.useState(!0),[K,w]=n.useState(!1),[y,M]=n.useState(null),[S,f]=n.useState(!1),[C,Q]=n.useState(""),[l,g]=n.useState(new Set),[X,A]=n.useState(!1),[o,k]=n.useState({service_type:"",priority:"",is_active:""}),[a,i]=n.useState({name:"",address:"",city:"",state:"WI",zip:"",contact_name:"",contact_phone:"",contact_email:"",latitude:"",longitude:"",geofence_radius:"100",priority:"5",service_type:"both",notes:"",is_active:!0}),N=async()=>{L(!0);try{const{data:s,error:t}=await v.from("accounts").select("*").order("priority").order("name");if(t)throw t;Z(s||[])}catch(s){console.error("Error fetching accounts:",s),d.error("Failed to load accounts")}finally{L(!1)}};n.useEffect(()=>{N()},[]);const T=s=>{s?(M(s),i({name:s.name,address:s.address,city:s.city||"",state:s.state||"WI",zip:s.zip||"",contact_name:s.contact_name||"",contact_phone:s.contact_phone||"",contact_email:s.contact_email||"",latitude:s.latitude?.toString()||"",longitude:s.longitude?.toString()||"",geofence_radius:s.geofence_radius?.toString()||"100",priority:s.priority?.toString()||"5",service_type:s.service_type||"both",notes:s.notes||"",is_active:s.is_active})):(M(null),i({name:"",address:"",city:"",state:"WI",zip:"",contact_name:"",contact_phone:"",contact_email:"",latitude:"",longitude:"",geofence_radius:"100",priority:"5",service_type:"both",notes:"",is_active:!0})),w(!0)},ee=async()=>{const s=ve.safeParse(a);if(!s.success){d.error(ye(s.error));return}f(!0);try{const t=s.data,D={name:t.name,address:t.address,city:t.city||null,state:t.state||null,zip:t.zip||null,contact_name:t.contact_name||null,contact_phone:t.contact_phone||null,contact_email:t.contact_email||null,latitude:t.latitude?parseFloat(t.latitude):null,longitude:t.longitude?parseFloat(t.longitude):null,geofence_radius:t.geofence_radius?parseInt(t.geofence_radius):100,priority:t.priority?parseInt(t.priority):5,service_type:a.service_type,notes:t.notes||null,is_active:t.is_active};if(y){const{error:p}=await v.from("accounts").update(D).eq("id",y.id);if(p)throw p;d.success("Account updated")}else{const{error:p}=await v.from("accounts").insert(D);if(p)throw p;d.success("Account created")}w(!1),N()}catch(t){console.error("Error saving account:",t),d.error("Failed to save account")}finally{f(!1)}},se=async s=>{if(confirm("Are you sure you want to delete this account?"))try{const{error:t}=await v.from("accounts").delete().eq("id",s);if(t)throw t;d.success("Account deleted"),N()}catch(t){console.error("Error deleting account:",t),d.error("Failed to delete account")}},te=()=>{l.size===u.length?g(new Set):g(new Set(u.map(s=>s.id)))},ae=s=>{const t=new Set(l);t.has(s)?t.delete(s):t.add(s),g(t)},re=()=>{k({service_type:"",priority:"",is_active:""}),A(!0)},ie=async()=>{if(l.size!==0){f(!0);try{const s={};if(o.service_type&&(s.service_type=o.service_type),o.priority&&(s.priority=parseInt(o.priority)),o.is_active!==""&&(s.is_active=o.is_active==="true"),Object.keys(s).length===0){d.error("Please select at least one field to update"),f(!1);return}const{error:t}=await v.from("accounts").update(s).in("id",Array.from(l));if(t)throw t;d.success(`Updated ${l.size} accounts`),A(!1),g(new Set),N()}catch(s){console.error("Error bulk updating accounts:",s),d.error("Failed to update accounts")}finally{f(!1)}}},le=async()=>{if(l.size!==0&&confirm(`Are you sure you want to delete ${l.size} accounts?`))try{const{error:s}=await v.from("accounts").delete().in("id",Array.from(l));if(s)throw s;d.success(`Deleted ${l.size} accounts`),g(new Set),N()}catch(s){console.error("Error bulk deleting accounts:",s),d.error("Failed to delete accounts")}},u=n.useMemo(()=>{if(!C)return m;const s=C.toLowerCase();return m.filter(t=>t.name.toLowerCase().includes(s)||t.address.toLowerCase().includes(s))},[m,C]),z=n.useMemo(()=>{const s=m.filter(p=>p.is_active).length,t=m.length,D=Math.floor(m.length*.5);return{total:m.length,active:s,plow:t,shovel:D}},[m]),ce=s=>s?s<=3?e.jsx(x,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"high"}):s<=6?e.jsx(x,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"medium"}):e.jsx(x,{variant:"outline",children:"low"}):e.jsx(x,{variant:"outline",children:"medium"}),ne=s=>{const t=s.service_type||"both";return t==="plow"?e.jsx(x,{className:"bg-primary/20 text-primary border-primary/30",children:"Plow"}):t==="shovel"?e.jsx(x,{className:"bg-shovel/20 text-shovel border-shovel/30",children:"Shovel"}):e.jsx(x,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Both"})};return J?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Accounts"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer accounts and service locations"})]}),e.jsxs(h,{variant:"outline",className:"gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Import CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(b,{className:"bg-card/50 border-border/50",children:e.jsxs(_,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold",children:z.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Accounts"})]})}),e.jsx(b,{className:"bg-card/50 border-border/50",children:e.jsxs(_,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:z.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active"})]})}),e.jsx(b,{className:"bg-card/50 border-border/50",children:e.jsxs(_,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:z.plow}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Plow Service"})]})}),e.jsx(b,{className:"bg-card/50 border-border/50",children:e.jsxs(_,{className:"pt-4 pb-4",children:[e.jsx("p",{className:"text-2xl font-bold text-shovel",children:z.shovel}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Shovel Service"})]})})]}),e.jsx(b,{className:"bg-card/50 border-border/50",children:e.jsxs(_,{className:"pt-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Search accounts...",value:C,onChange:s=>Q(s.target.value),className:"pl-9 bg-muted/30 border-border/50"})]}),e.jsxs(h,{onClick:()=>T(),className:"gap-2 bg-primary hover:bg-primary/90",children:[e.jsx(oe,{className:"h-4 w-4"}),"Add Account"]})]}),l.size>0&&e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-3 bg-primary/10 border border-primary/30 rounded-lg",children:[e.jsxs("span",{className:"text-sm font-medium",children:[l.size," selected"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(h,{size:"sm",variant:"outline",onClick:re,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Bulk Edit"]}),e.jsxs(h,{size:"sm",variant:"outline",className:"text-destructive border-destructive/50 hover:bg-destructive/10",onClick:le,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Delete Selected"]}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>g(new Set),children:"Clear"})]}),e.jsx("div",{className:"rounded-lg border border-border/50 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/30",children:e.jsxs("tr",{className:"text-left text-sm text-muted-foreground",children:[e.jsx("th",{className:"px-4 py-3 font-medium w-10",children:e.jsx(O,{checked:l.size===u.length&&u.length>0,onCheckedChange:te})}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Address"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Contact"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Service"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Priority"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-medium text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-border/50",children:[u.map(s=>e.jsxs("tr",{className:`hover:bg-muted/20 transition-colors ${l.has(s.id)?"bg-primary/5":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(O,{checked:l.has(s.id),onCheckedChange:()=>ae(s.id)})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-muted/50 flex items-center justify-center",children:e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(Ne,{className:"h-3 w-3 shrink-0"}),e.jsxs("span",{className:"truncate max-w-[200px]",children:[s.address,s.city?`, ${s.city}`:"",s.state?`, ${s.state}`:""," ",s.zip||""]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.contact_name||"-"}),e.jsx("td",{className:"px-4 py-3",children:ne(s)}),e.jsx("td",{className:"px-4 py-3",children:ce(s.priority)}),e.jsx("td",{className:"px-4 py-3",children:s.is_active?e.jsx(x,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Active"}):e.jsx(x,{variant:"outline",className:"text-muted-foreground",children:"Inactive"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs(he,{children:[e.jsx(me,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(xe,{align:"end",children:[e.jsxs(V,{onClick:()=>T(s),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(V,{onClick:()=>se(s.id),className:"text-destructive",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},s.id)),u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-muted-foreground",children:"No accounts found"})})]})]})}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-4",children:["Showing ",u.length," of ",m.length," results"]})]})}),e.jsx(U,{open:K,onOpenChange:w,children:e.jsxs($,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(q,{children:[e.jsx(R,{children:y?"Edit Account":"Add Account"}),e.jsx(W,{children:y?"Update service location":"Add a new service location"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"name",children:"Account Name *"}),e.jsx(c,{id:"name",value:a.name,onChange:s=>i({...a,name:s.target.value}),placeholder:"e.g., Main Street Plaza"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"address",children:"Address *"}),e.jsx(c,{id:"address",value:a.address,onChange:s=>i({...a,address:s.target.value}),placeholder:"123 Main St"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"city",children:"City"}),e.jsx(c,{id:"city",value:a.city,onChange:s=>i({...a,city:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"state",children:"State"}),e.jsx(c,{id:"state",value:a.state,onChange:s=>i({...a,state:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"zip",children:"ZIP"}),e.jsx(c,{id:"zip",value:a.zip,onChange:s=>i({...a,zip:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"contact_name",children:"Contact Name"}),e.jsx(c,{id:"contact_name",value:a.contact_name,onChange:s=>i({...a,contact_name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"contact_phone",children:"Contact Phone"}),e.jsx(c,{id:"contact_phone",value:a.contact_phone,onChange:s=>i({...a,contact_phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"contact_email",children:"Contact Email"}),e.jsx(c,{id:"contact_email",type:"email",value:a.contact_email,onChange:s=>i({...a,contact_email:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"latitude",children:"Latitude"}),e.jsx(c,{id:"latitude",type:"number",step:"any",value:a.latitude,onChange:s=>i({...a,latitude:s.target.value}),placeholder:"42.3314"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"longitude",children:"Longitude"}),e.jsx(c,{id:"longitude",type:"number",step:"any",value:a.longitude,onChange:s=>i({...a,longitude:s.target.value}),placeholder:"-83.0458"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"geofence_radius",children:"Geofence (meters)"}),e.jsx(c,{id:"geofence_radius",type:"number",value:a.geofence_radius,onChange:s=>i({...a,geofence_radius:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"priority",children:"Priority (1-10, lower = higher)"}),e.jsx(c,{id:"priority",type:"number",min:"1",max:"10",value:a.priority,onChange:s=>i({...a,priority:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Service Type"}),e.jsxs(I,{value:a.service_type,onValueChange:s=>i({...a,service_type:s}),children:[e.jsx(E,{className:"bg-card",children:e.jsx(P,{})}),e.jsx(B,{className:"bg-card",children:be.map(s=>e.jsx(j,{value:s,children:e.jsx("span",{className:"capitalize",children:s})},s))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(pe,{id:"is_active",checked:a.is_active,onCheckedChange:s=>i({...a,is_active:s})}),e.jsx(r,{htmlFor:"is_active",children:"Active Account"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"notes",children:"Notes"}),e.jsx(ue,{id:"notes",value:a.notes,onChange:s=>i({...a,notes:s.target.value}),placeholder:"Special instructions, access codes, etc."})]})]}),e.jsxs(G,{children:[e.jsx(h,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsxs(h,{onClick:ee,disabled:S,children:[S&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),y?"Update":"Create"]})]})]})}),e.jsx(U,{open:X,onOpenChange:A,children:e.jsxs($,{children:[e.jsxs(q,{children:[e.jsxs(R,{children:["Bulk Edit ",l.size," Accounts"]}),e.jsx(W,{children:"Only fields you change will be updated. Leave fields empty to keep existing values."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Service Type"}),e.jsxs(I,{value:o.service_type,onValueChange:s=>k({...o,service_type:s}),children:[e.jsx(E,{className:"bg-card",children:e.jsx(P,{placeholder:"No change"})}),e.jsxs(B,{className:"bg-card",children:[e.jsx(j,{value:"plow",children:"Plow"}),e.jsx(j,{value:"shovel",children:"Shovel"}),e.jsx(j,{value:"both",children:"Both"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Priority (1-10)"}),e.jsx(c,{type:"number",min:"1",max:"10",value:o.priority,onChange:s=>k({...o,priority:s.target.value}),placeholder:"No change"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Status"}),e.jsxs(I,{value:o.is_active,onValueChange:s=>k({...o,is_active:s}),children:[e.jsx(E,{className:"bg-card",children:e.jsx(P,{placeholder:"No change"})}),e.jsxs(B,{className:"bg-card",children:[e.jsx(j,{value:"true",children:"Active"}),e.jsx(j,{value:"false",children:"Inactive"})]})]})]})]}),e.jsxs(G,{children:[e.jsx(h,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsxs(h,{onClick:ie,disabled:S,children:[S&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),"Update ",l.size," Accounts"]})]})]})})]})}export{Fe as default};
